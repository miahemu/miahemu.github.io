<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>MySQL相关面试题 | 和睦的拾光物语</title><meta name="keywords" content="JAVA面经"><meta name="author" content="玦尘"><meta name="copyright" content="玦尘"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="MySQL相关面试题"><meta name="application-name" content="MySQL相关面试题"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="MySQL相关面试题"><meta property="og:url" content="http://miahemu.github.io/2025/03/24/MySQL相关面试题/index.html"><meta property="og:site_name" content="和睦的拾光物语"><meta property="og:description" content="基于技术书籍对Java面试过程中所遇到的重点问题进行深度解读，整合了来自JavaGuide等著名博主的面经分享，并回归课本进行了重写与补充。"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://w.wallhaven.cc/full/ym/wallhaven-ym22lk.jpg"><meta property="article:author" content="玦尘"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://w.wallhaven.cc/full/ym/wallhaven-ym22lk.jpg"><meta name="description" content="基于技术书籍对Java面试过程中所遇到的重点问题进行深度解读，整合了来自JavaGuide等著名博主的面经分享，并回归课本进行了重写与补充。"><link rel="shortcut icon" href="https://pic1.imgdb.cn/item/67dfd64f88c538a9b5c51349.png"><link rel="canonical" href="http://miahemu.github.io/2025/03/24/MySQL%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"此去经年，别忘了归途","backTitle":"还知道回来？"},
  LA51: {"enable":true,"ck":"3LdBYNynGFmvRJ0D","LingQueMonitorID":null},
  greetingBox: {"enable":true,"default":"晚上好👋 愿你拥有美好的时光！","list":[{"greeting":"夜深了，早点休息，晚安😴","startTime":0,"endTime":5},{"greeting":"早上好☀️ 愿你的一天从愉快开始！","startTime":6,"endTime":9},{"greeting":"上午好👋 状态满满，加油迎接新的一天！","startTime":10,"endTime":10},{"greeting":"11点多啦，午餐时间快到了，继续加油！","startTime":11,"endTime":11},{"greeting":"午安！🌿 休息一下，享受美好的午后时光。","startTime":12,"endTime":14},{"greeting":"下午好！☕ 工作辛苦了，别忘了适当放松一下~","startTime":14,"endTime":18},{"greeting":"晚餐时间到啦！🍽️ 奖励自己一顿美食吧！","startTime":19,"endTime":19},{"greeting":"晚上好👋 愿你在属于自己的时间里放松身心~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":2},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🚀 数码科技探索者","🌿 乐于分享，热心助人","🏡 智能家居智造者","🛠 全栈式设计与开发","🎯 专注交互体验优化","🏃 执行力满分的实干家","⚙️ 团队协作的驱动力","💪 低调务实的实力派"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: 玦尘","link":"链接: ","source":"来源: 和睦的拾光物语","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '和睦的拾光物语',
  title: 'MySQL相关面试题',
  postAI: '',
  pageFillDescription: '面试官： 数据库的三大范式, 面试官： 说一下外键约束, 面试官： 说一下binlog, 面试官：MySQL binlogredolog和undolog的区别, 面试官： MyISAM和InnoDB区别, 面试官： MySQL（以 InnoDB 为例）实现的锁类型？, 面试官： MySQL中如何定位慢查询?（高频）, 面试官： 那这个SQL语句执行很慢 如何分析呢？（高频）, 面试官： 一条SQL语句执行得很慢的原因有哪些？, 一、针对偶尔很慢的情况, 二、针对一直都这么慢的情况, 面试官： MySQL中 SQL 查询和更新语句的执行流程？, 一、 MySQL 基础架构分析, 二、语句分析, 面试官： IP地址如何在数据库里存储？, 面试官： 什么是索引 （高频）, 面试官： 索引的底层数据结构了解过嘛 ? （高频）, 面试官： B树和B+树的区别是什么呢？（高频）, 面试官： 什么是聚簇索引？什么是非聚簇索引（辅助索引） ?, 面试官： 知道什么是回表查询嘛 ?, 面试官： MySQL的主键索引为什么用自增ID不使用UUID？, 面试官： 知道什么叫覆盖索引嘛 ?, 面试官： MySQL超大分页怎么处理 ?, 面试官： 什么情况下索引会失效 ?（高频）, 面试官： sql的优化的经验（慢查询优化）（高频）, 面试官： 创建表的时候你们是如何优化的呢？, 面试官： 那在使用索引的时候是如何优化呢？（高频）, 面试官： 你平时对sql语句做了哪些优化呢？（高频）, 面试官： 事务的特性是什么？可以详细说一下吗？, 面试官：并发事务带来哪些问题？, 面试官：怎么解决这些问题呢？MySQL的默认隔离级别是？（高频）, 面试官：MySQL 中单表最多不能超过2000w？为什么？, 面试官：事务中的隔离性是如何保证的呢？(你解释一下MVCC), 面试官：MySQL主从同步原理, 面试官： 谈谈你对读写分离和分库分表的理解（高频）, 读写分离, 何为读写分离？, 读写分离会带来什么问题？如何解决？, 如何实现读写分离？, 分库分表, 什么情况下需要分库分表？, 分库分表会带来什么问题呢？, 相关阅读：本文为原创内容转载请注明出处并附带原文链接感谢您的尊重与支持你必须非常努力才能看起来毫不费劲面试官数据库的三大范式候选人每个列都不可拆分在第一范式的基础上非主键列完全依赖于主键而不能是依赖于主键的一部分在第二范式的基础上非主键列只依赖于主键不依赖于其他非主键列面试官说一下外键约束候选人外键约束的作用是维护表与表之间的关系确保数据的完整性和一致性让我们举一个简单的例子假设你有两个表一个是学生表另一个是课程表这两个表之间有一个关系即一个学生可以选修多门课程而一门课程也可以被多个学生选修在这种情况下我们可以在学生表中定义一个指向课程表的外键如下所示这里表中的字段是一个外键它指向表中的字段这个外键约束确保了每个学生所选的课程在表中都存在从而维护了数据的完整性和一致性如果没有定义外键约束那么就有可能出现学生选了不存在的课程或者删除了一个课程而忘记从学生表中删除选修该课程的学生的情况这会破坏数据的完整性和一致性因此使用外键约束可以帮助我们避免这些问题面试官说一下候选人日志是数据库的一种日志记录机制用于记录数据库的修改操作如插入更新删除等以便在需要时进行数据恢复数据复制和数据同步等操作日志的实现以下功能数据恢复日志可以用于回滚到之前的某个时间点从而恢复数据数据复制日志可以用于在主从数据库之间复制数据从而实现数据的高可用和负载均衡等功能的日志有三种格式分别是格式格式和格式它们之间的区别如下每一条修改数据的都会被记录到中相当于记录了逻辑操作所以针对这种格式可以称为逻辑日志主从复制中端再根据语句重现记录行数据最终被修改成什么样了这种格式的日志就不能称为逻辑日志了不会出现下动态函数的问题但的缺点是每行数据的变化结果都会被记录比如执行批量语句更新多少行数据就会产生多少条记录使文件过大包含了和模式它会根据不同的情况自动使用模式和模式面试官和的区别候选人二进制日志记录所有对数据库的修改操作包括插入更新和删除等主要用于数据恢复到指定时间点或者指定事务可以使用命令将文件解析成语句从而恢复数据库的状态重做日志记录所有对数据库的修改操作但是只记录了物理操作比如页的修改主要用于的崩溃恢复即在崩溃后通过重做日志将数据库恢复到最近一次提交的状态回滚日志用于记录事务的回滚操作即在事务执行过程中如果发生了回滚会将回滚操作记录到中主要用于的回滚操作比如使用语句回滚事务是存储引擎的特有日志不同于其他存储引擎面试官和区别候选人是否持级锁只有表级锁持级锁和表级锁默认为级锁补充行级锁和表级锁行级锁是一种细粒度的锁机制它只锁定对特定行的访问这意味着当一个事务正在更新或删除一个表中的某一行时其他事务不能同时更新或删除这一行但它们仍然可以读取这一行或者修改表中的其他行这种锁的优点是它提供了更好的并发性能因为多个事务可以在同一时间内操作表的不同部分缺点是它可能会导致更高的开销因为系统需要跟踪哪些行已经被锁定表级锁是一种粗粒度的锁机制它锁定整个表当一个事务对某个表进行读写操作时它可以阻止其他事务对该表的任何访问直到锁被释放这种锁的优点是实现简单管理成本相对较低缺点是由于锁住了整个表所以并发能力较差尤其是在需要频繁并发读写的情况下是否持事务和崩溃后的安全恢复强调的是性能每次查询具有原性其执速度类型更快但是不提供事务持但是提供事务持事务外部键等级数据库功能具有提交事务回滚和崩溃修复能是否持外键不持持是否持仅持应对并发事务单纯的加锁更效只在和两个隔离级别下作可以使乐观锁和悲观锁来实现高性能上有句话这样写到不要轻易相信快之类的经验之谈这个结论往往不是绝对的在很多我们已知场景中的速度都可以让望尘莫及尤其是到了聚簇索引或者需要访问的数据都可以放内存的应补充乐观锁与悲观锁悲观锁基于假设当事务要对某个数据进操作时认为很可能会发冲突因此在事务开始时就对数据进锁定阻其他事务同时对其进修改直到当前事务完成这种式虽然能够保证数据的致性和准确性但由于锁的存在可能会导致其他事务等待增加了系统开销乐观锁基于另种假设认为事务之间发冲突的概率较低因此在读取数据时不即加锁是允许多个事务同时读取数据当事务尝试提交更改时会检查在此期间是否有其他事务修改过相同的数据如果有冲突则当前事务失败可能需要回滚并重新开始乐观锁通常通过版本号或时间戳来检测数据是否已被修改面试官以为例实现的锁类型候选人大体上可以从两个层面回答表级锁读写锁意向锁和行级锁记录锁间隙锁临键锁表级锁读写锁主要用于锁定整个表分为读锁和写锁通过命令手动触发意向锁由自动管理用于协调表级锁和行级锁之间的关系表示事务打算对表中的某些行加锁而不是直接锁住数据行级锁记录锁记录锁是一种行级锁精确锁住索引记录上的某一行不涉及范围只在中实现间隙锁间隙锁锁住索引记录之间的间隙防止其他事务在该范围内插入新记录是在可重复读隔离级别下的默认行锁机制临键锁临键锁是记录锁和间隙锁的组合锁住一个索引记录以及它前面的间隙形成左开右闭区间同时也是在可重复读隔离级别下防止幻读的关键机制面试官中如何定位慢查询高频候选人嗯我们当时做压测的时候有的接口非常的慢接口的响应时间超过了秒以上因为我们当时的系统部署了运维的监控系统在展示的报表中可以看到是哪一个接口比较慢并且可以分析这个接口哪部分比较慢这里可以看到的具体的执行时间所以可以定位是哪个出了问题如果项目中没有这种运维的监控系统其实在中也提供了慢日志查询的功能可以在的系统配置文件中开启这个慢日志的功能并且也可以设置执行超过多少时间来记录到一个日志文件中我记得上一个项目配置的是秒只要执行的时间超过了秒就会记录到日志文件中我们就可以在日志文件找到执行比较慢的了启用慢查询日志定义慢查询的时间阈值默认为秒面试官那这个语句执行很慢如何分析呢高频候选人如果一条执行很慢的话我们通常会使用自动的执行计划来去查看这条的执行情况比如在这里面可以通过实际使用的索引和使用的索引长度检查是否命中了索引如果本身已经添加了索引也可以判断索引是否有失效的情况第二个可以通过字段查看是否有进一步的优化空间是否存在全索引扫描或全盘扫描第三个可以通过建议来判断是否出现了回表的情况如果出现了可以尝试添加索引或修改返回字段来修复案例假设我们有一个数据库表结构如下现在我们想分析下面这个查询的执行计划我们可以使用如下执行这条命令后会得到一个结果集从这个例子中可以看出因为和没有索引所以需要对整个表进行全表扫描来查找符合条件的记录这在数据量大时会非常低效面试官一条语句执行得很慢的原因有哪些候选人分以下两种情况来讨论大多数情况是正常的只是偶尔会出现很慢的情况在数据量不变的情况下这条语句一直以来都执行的很慢一针对偶尔很慢的情况一条大多数情况正常偶尔才能出现很慢的情况针对这种情况我觉得这条语句的书写本身是没什么问题的而是其他原因导致的那会是什么原因呢数据库在刷新脏页我也无奈啊当我们要往数据库插入一条数据或者要更新一条数据的时候我们知道数据库会在内存中把对应字段的数据更新了但是更新之后这些更新的字段并不会马上同步持久化到磁盘中去而是把这些更新的记录写入到日记中去等到空闲的时候在通过里的日记把最新的数据同步到磁盘中去当内存数据页跟磁盘数据页内容不一致的时候我们称这个内存页为脏页内存数据写入到磁盘后内存和磁盘上的数据页的内容就一致了称为干净页刷脏页有下面种场景写满了里的容量是有限的如果数据库一直很忙更新又很频繁这个时候很快就会被写满了这个时候就没办法等到空闲的时候再把数据同步到磁盘的只能暂停其他操作全身心来把数据同步到磁盘中去的而这个时候就会导致我们平时正常的语句突然执行的很慢所以说数据库在在同步数据到磁盘的时候就有可能导致我们的语句执行的很慢了内存不够用了如果一次查询较多的数据恰好碰到所查数据页不在内存中时需要申请内存而此时恰好内存不足的时候就需要淘汰一部分内存数据页如果是干净页就直接释放如果恰好是脏页就需要刷新脏页拿不到锁我能怎么办这个就比较容易想到了我们要执行的这条语句刚好这条语句涉及到的表别人在用并且加锁了我们拿不到锁只能慢慢等待别人释放锁了或者表没有加锁但要使用到的某一行被加锁了这个时候我也没办法啊如果要判断是否真的在等待锁我们可以用这个命令来查看当前的状态二针对一直都这么慢的情况如果在数据量一样大的情况下这条语句每次都执行的这么慢那就就要好好考虑下你的书写了下面我们来分析下哪些原因会导致我们的语句执行的很不理想我们先来假设我们有一个表表里有下面两个字段分别是主键和两个普通字段和没用到索引字段没有索引刚好字段上没有索引只能走全表扫描了体验不会索引带来的乐趣了所以这会导致这条查询语句很慢字段有索引但却没有用索引好吧这个时候你给这个字段加上了索引然后又查询了一条语句但是这样子在查询的时候会用索引查询吗答是不会如果我们在字段的左边做了运算那么很抱歉在查询的时候就不会用上索引了所以呢大家要注意这种字段上有索引但由于自己的疏忽导致系统没有使用索引的情况了正确的查询应该如下有人可能会说右边有运算就能用上索引难道数据库就不会自动帮我们优化一下自动把自动转换为不好意思确实不会帮你所以你要注意了函数操作导致没有用上索引如果我们在查询的时候对字段进行了函数操作也是会导致没有用上索引的例如这里只是做一个例子假设函数是求的次方实际上可能并没有这个函数其实这个和上面在左边做运算也是很类似的数据库自己选错索引了我们在进行查询操作的时候例如我们知道主键索引和非主键索引是有区别的主键索引存放的值是整行字段的数据而非主键索引上存放的值不是整行字段的数据而且存放主键字段的值也就是说我们如果走这个字段的索引的话最后会查询到对应主键的值然后再根据主键的值走主键索引查询到整行数据返回所以就算你在字段上有索引系统也并不一定会走这个字段上的索引而是有可能会直接扫描扫描全表找出所有符合的数据为什么会这样呢其实是这样的系统在执行这条语句的时候会进行预测究竟是走索引扫描的行数少还是直接扫描全表扫描的行数少呢显然扫描行数越少当然越好了因为扫描行数越少意味着操作的次数越少如果是扫描全表的话那么扫描的次数就是这个表的总行数了假设为而如果走索引的话我们通过索引找到主键之后还得再通过主键索引来找我们整行的数据也就是说需要走两次索引而且我们也不知道符合这个条件的数据有多少行万一这个表是全部数据都符合呢这个时候意味着走索引不仅扫描的行数是同时还得每行数据走两次索引系统是有可能走全表扫描而不走索引的那系统是怎么判断呢判断来源于系统的预测也就是说如果要走字段索引的话系统会预测走字段索引大概需要扫描多少行如果预测到要扫描的行数很多它可能就不走索引而直接扫描全表了那么问题来了系统是怎么预测判断的呢系统是通过索引的区分度来判断的一个索引上不同的值越多意味着出现相同数值的索引越少意味着索引的区分度越高我们也把区分度称之为基数即区分度越高基数越大所以呢基数越大意味着符合这个条件的行数越少所以呢一个索引的基数越大意味着走索引查询越有优势那么问题来了怎么知道这个索引的基数呢系统当然是不会遍历全部来获得一个索引的基数的代价太大了索引系统是通过遍历部分数据也就是通过采样的方式来预测索引的基数的重点的来了居然是采样那就有可能出现失误的情况也就是说这个索引的基数实际上是很大的但是采样的时候却很不幸把这个索引的基数预测成很小例如你采样的那一部分数据刚好基数很小然后就误以为索引的基数很小然后系统就不走索引了直接走全部扫描了所以呢说了这么多得出结论由于统计的失误导致系统没有走索引而是走了全表扫描而这也是导致我们语句执行的很慢的原因不过呢我们有时候也可以通过强制走索引的方式来查询例如我们也可以通过来查询索引的基数和实际是否符合如果和实际很不符合的话我们可以重新来统计索引的基数可以用这条命令来重新统计分析既然会预测错索引的基数这也意味着当我们的查询语句有多个索引的时候系统有可能也会选错索引这也可能是执行的很慢的一个原因面试官中查询和更新语句的执行流程候选人一基础架构分析下图是的一个简要架构图从下图你可以很清晰的看到用户的语句在内部是如何执行的连接器身份认证和权限相关登录的时候查询缓存执行查询语句的时候会先查询缓存版本后移除缓存虽然能够提升数据库的查询性能但是缓存同时也带来了额外的开销每次查询后都要做次缓存操作失效后还要销毁分析器没有命中缓存的话语句就会经过分析器分析器说白了就是要先看你的语句要干嘛再检查你的语句语法是否正确优化器按照认为最优的方案去执行执行器执行具体的语句之前会校验该用户有没有权限如果没有权限就会返回错误信息如果有权限就会去调用存储引擎的接口返回接口执行的结果简单来说主要分为层和存储引擎层层主要包括连接器查询缓存分析器优化器执行器等所有跨存储引擎的功能都在这一层实现比如存储过程触发器视图函数等还有一个通用的日志模块日志模块存储引擎主要负责数据的存储和读取采用可以替换的插件式架构支持等多个存储引擎其中引擎有自带的日志模块现在最常用的存储引擎是它从版本开始就被当做默认存储引擎了二语句分析查询语句我们先分析下查询语句语句如下张三结合上面的说明我们分析下这个语句的执行流程先检查该语句是否有权限如果没有权限直接返回错误信息如果有权限在版本以前会先查询缓存如果有直接返回如果没有执行下一步通过分析器进行词法分析提取语句的关键元素比如提取上面这个语句是查询提取需要查询的表名为需要查询所有的列查询条件是这个表的然后判断这个语句是否有语法错误比如关键词是否正确等等如果检查没问题就执行下一步接下来就是优化器进行确定执行方案上面的语句可以有两种执行方案先查询学生表中姓名为张三的学生然后判断是否年龄是先找出学生中年龄岁的学生然后再查询姓名为张三的学生那么优化器根据自己的优化算法进行选择执行效率最好的一个方案优化器认为有时候不一定最好那么确认了执行计划后就准备开始执行了进行权限校验如果没有权限就会返回错误信息如果有权限就会调用存储引擎接口返回引擎的执行结果更新语句接下来我们看看一条更新语句如何执行的呢语句如下张三其实这条语句也基本上会沿着上一个查询的流程走只不过执行更新的时候肯定要记录日志这就会引入日志模块了自带的日志模块是归档日志所有的存储引擎都可以使用我们常用的引擎还自带了一个日志模块重做日志我们就以模式下来探讨这个语句的执行流程流程如下先查询到张三这一条数据不会走查询缓存因为更新语句会导致与该表相关的查询缓存失效然后拿到查询的语句把改为然后调用存储引擎接口写入这一行数据引擎把数据保存在内存中同时记录此时进入预提交状态然后告诉执行器执行完成了随时可以提交执行器收到通知后记录然后调用存储引擎接口提交为提交状态更新完成这里肯定有同学会问为什么要用两个日志模块用一个日志模块不行吗并不是说只用一个日志模块不可以只是引擎就是通过来支持事务的那么又会有同学问我用两个日志模块但是不要这么复杂行不行为什么要引入预提交状态这里我们用反证法来说明下为什么要这么做先写直接提交然后写假设写完后机器挂了日志没有被写入那么机器重启后这台机器会通过恢复数据但是这个时候并没有记录该数据后续进行机器备份的时候就会丢失这一条数据同时主从同步也会丢失这一条数据先写然后写假设写完了机器异常重启了由于没有记录本机是无法恢复这一条记录的但是又有记录那么和上面同样的道理就会产生数据不一致的情况如果采用两阶段提交的方式就不一样了写完后然后再提交就会防止出现上述的问题从而保证了数据的一致性那么问题来了有没有一个极端的情况呢假设处于预提交状态也已经写完了这个时候发生了异常重启会怎么样呢这个就要依赖于的处理机制了的处理过程如下判断是否完整如果判断是完整的就立即提交如果只是预提交但不是状态这个时候就会去判断是否完整如果完整就提交不完整就回滚事务这样就解决了数据一致性的问题面试官地址如何在数据库里存储候选人地址是一个位的二进制数通常以点分十进制表示法呈现例如字符串类型的存储方式直接将地址作为字符串存储在数据库中比如可以用来存储创建一个表使用类型存储地址插入数据优点直观易懂方便直接进行数据的插入查询和显示不需要进行额外的转换操作缺点占用存储空间较大字符串比较操作的性能相对较低不利于进行范围查询整数类型的存储方式将地址转换为位无符号整数进行存储常用的数据类型有创建一个表使用类型存储地址插入数据需要先将地址转换为整数查询时将整数转换回地址优点占用存储空间小整数比较操作的性能较高便于进行范围查询缺点需要进行额外的转换操作不够直观增加了开发的复杂度面试官什么是索引高频候选人嗯索引是帮助高效获取数据的数据结构主要是用来提高数据检索的效率降低数据库的成本同时通过索引列对数据进行排序降低数据排序的成本也能降低了的消耗面试官索引的底层数据结构了解过嘛高频候选人的默认的存储引擎采用的树的数据结构来存储索引选择树的主要的原因是第一阶数更多路径更短这减少了树的高度从而缩短了从根到叶子节点的路径长度从而提高了检索效率第二个磁盘读写代价树更低只有叶子节点存储实际的数据记录而所有非叶子节点保存索引键值和指针信息第三是树便于扫库和区间查询所有的叶子节点都通过双向链表连接在一起面试官树和树的区别是什么呢高频候选人第一在树中非叶子节点和叶子节点都会存放数据而树的所有的数据都会出现在叶子节点在查询的时候树查找效率更加稳定第二在进行范围查询的时候树效率更高因为树都在叶子节点存储并且叶子节点是一个双向链表面试官什么是聚簇索引什么是非聚簇索引辅助索引候选人聚簇索引主要是指数据与索引放到一块树的叶子节点保存了整行数据有且只有一个这意味着表中的数据行按照索引键的顺序存放通常这个索引是主键索引非聚簇索引辅助索引主要是数据与索引分开存储树的叶子节点保存对应的主键值可以有多个当用户定义额外的索引时如唯一索引普通索引等这些索引就是非聚簇索引面试官知道什么是回表查询嘛候选人嗯其实跟刚才介绍的聚簇索引和非聚簇索引是有关系的回表的意思就是通过辅助索引找到对应的主键值然后再通过主键值找到聚集索引中所对应的整行数据这个过程就是回表备注如果面试官直接问回表则需要先介绍聚簇索引和非聚簇索引面试官的主键索引为什么用自增不使用候选人一般情况下推荐使用自增因为在的存储引擎中主键索引就是聚簇索引主键索引的树的叶子结点按顺序存储主键值和数据如果主键索引是自增只需按顺序往后排列即可如果是是随机生成的在数据插入时会造成大量的数据移动产生大量碎片面试官知道什么叫覆盖索引嘛候选人如果一个索引包含了查询语句中所需要的所有列索引全部命中了那么这个索引就是一个覆盖索引如果我们使用查询它会直接走覆盖索引查询一次索引扫描直接返回数据性能高如果按照辅助索引查询数据的时候返回的列中没有创建索引有可能会触发回表查询尽量避免使用尽量在返回的列中都包含添加索引的字段面试官超大分页怎么处理候选人超大分页一般都是在数据量比较大时我们使用了分页查询并且需要对数据进行排序这个时候效率就很低例如我们执行此时需排序前条记录仅仅返回的记录其他记录要丢弃这时查询排序的代价就非常大了不过我们可以采用覆盖索引和子查询来解决先分页查询数据的字段确定了之后再用子查询来过滤只查询这个列表中的数据就可以了因为查询的时候走的覆盖索引所以效率可以提升很多面试官什么情况下索引会失效高频候选人嗯这个情况比较多我说一些自己的经验以前遇到过的比如索引在使用的时候没有遵循最左匹配法则假设有一个复合索引其中是最左边的列查询语句如下在这种情况下虽然有复合索引但是因为查询条件没有从索引的最左侧开始所以无法利用这个索引模糊查询如果号在前面也会导致索引失效假设有一个索引查询语句如下这里放在了模式字符串的开头意味着匹配任意数量的字符后跟着由于放在了开头数据库无法利用索引来加速查询因为任何字符都可能匹配所以只能进行全面扫描如果在添加索引的字段上进行了运算操作或者类型转换也都会导致索引失效假设有一个索引查询语句如下这里对进行了加法运算导致索引无法被使用同样如果对进行类型转换例如也会导致索引失效如果使用了复合索引中间使用了范围查询右边的条件索引也会失效假设有一个复合索引查询语句如下在这个查询中虽然和的条件可以使用索引但是由于使用了范围查询导致的条件无法使用索引加速查询因此尽管和的条件仍然可以使用部分索引但是的索引效果将被忽略当查询中使用了时索引可能会失效虽然支持对使用索引但在很多情况下特别是的查询数据库可能会选择全表扫描从而导致索引失效通常情况下想要判断出这条是否有索引失效的情况可以使用执行计划来分析面试官的优化的经验慢查询优化高频候选人嗯这个在项目还是挺常见的当然如果直说优化的话我们会从这几方面考虑比如建表的时候使用索引语句的编写主从复制读写分离还有一个是如果量比较大的话可以考虑分库分表面试官创建表的时候你们是如何优化的呢候选人对于数值型字段我们会根据预期的值域大小选择适当的类型如或这样既可以节省存储空间也能提高查询效率对于字符型字段我们会在和之间作出区分适合固定长度的字符串而更适用于长度可变的文本对于非常大的文本字段我们会考虑使用类型及其变体面试官那在使用索引的时候是如何优化呢高频候选人这个情况有很多不过都有一个大前提就是表中的数据要超过万以上我们才会创建索引并且添加索引的字段是查询比较频繁的字段一般也是像作为查询条件排序字段或分组的字段这些还有就是我们通常创建索引的时候都是使用复合索引来创建一条的返回值尽量使用覆盖索引如果字段的区分度不高的话我们也会把它放在组合索引后面的字段如果某一个字段的内容较长我们会考虑使用前缀索引来使用当然并不是所有的字段都要添加索引这个索引的数量也要控制因为添加索引也会导致新增改的速度变慢维护成本大面试官你平时对语句做了哪些优化呢高频候选人嗯这个也有很多比如语句务必指明字段名称不要直接使用还有就是要注意语句避免造成索引失效的写法如果是聚合查询尽量用代替会多一次过滤效率比较低如果是表关联的话尽量使用不要使用如必须使用一定要以小表为驱动补充和它会返回查询结果的所有行包括重复的行因此它的执行速度通常更快因为它不需要进行去重处理它会去除查询结果中的重复行然后返回最终结果这意味着在返回结果之前会进行去重处理这一步骤可能会消耗更多的计算资源因此执行速度较慢补充以小表为驱动怎么理解数据库在执行操作时通常会对驱动表进行扫描并为驱动表中的每一行查找另一表中的匹配行如果驱动表很大那么这种操作可能会非常耗时面试官事务的特性是什么可以详细说一下吗候选人分别指的是原子性一致性隔离性持久性我举个例子向转账转账成功扣除元增加元原子操作体现在要么都成功要么都失败在转账的过程中数据要一致扣除了必须增加在转账的过程中隔离性体现在向转账不能受其他事务干扰在转账的过程中持久性体现在事务提交后要把数据持久化可以说是落盘操作引擎通过什么技术来保证事务的这四个特性的呢原子性是通过回滚日志来保证的持久性是通过重做日志来保证的隔离性是通过多版本并发控制和锁机制来保证的一致性则是通过持久性原子性隔离性来保证面试官并发事务带来哪些问题候选人我们在项目开发中多个事务并发进行是经常发生的并发也是必然的有可能导致一些问题第一是脏读当一个事务正在访问数据并且对数据进行了修改而这种修改还没有提交到数据库中这时另外一个事务也访问了这个数据因为这个数据是还没有提交的数据那么另外一个事务读到的这个数据是脏数据依据脏数据所做的操作可能是不正确的一个事务读到另一个事务还未提交的数据第二是不可重复读比如在一个事务内多次读同一数据在这个事务还没有结束时另一个事务也访问该数据那么在第一个事务中的两次读数据之间由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样这就发生了在一个事务内两次读到的数据是不一样的情况因此称为不可重复读一个事务先后读取同一条记录但两次读取的数据不同第三是幻读幻读与不可重复读类似它发生在一个事务读取了几行数据接着另一个并发事务插入了一些数据时在随后的查询中第一个事务就会发现多了一些原本不存在的记录就好像发生了幻觉一样所以称为幻读一个事务按照条件查询时没有对应的数据行再次查询时发现多了一行数据补充不可重复读和幻读的区别不可重复读的重点是修改幻读的重点是新增或者删除面试官怎么解决这些问题呢的默认隔离级别是高频候选人解决方案是对事务进行隔离支持四种隔离级别分别有第一个是未提交读它解决不了刚才提出的所有问题一般项目中也不用这个第二个是读已提交它能解决脏读的问题的但是解决不了不可重复读和幻读第三个是可重复读在这个隔离级别下事务在执行期间会锁定查询的数据行临键锁确保该数据在事务完成前不会被其他事务修改它能解决脏读和不可重复读但是解决不了幻读这个也是默认的隔离级别除了串行化能解决幻读问题外在可重复读隔离级别下通过临键锁已经能够解决大部分幻读问题可以用串行化来保证数据的强一致性来做兜底而且还可以不用手动加锁第四个是串行化它可以解决刚才提出来的所有问题但是由于让是事务串行执行的性能比较低自动加共享锁其他事务无法插入或修改的记录所以我们一般使用的都是默认的隔离级别为可重复读面试官中单表最多不能超过为什么候选人的表数据是以页的形式存放的页在磁盘中不一定是连续的页的空间是并不是所有的空间都是用来存放数据的会有一些固定的信息如页头页尾页码校验码等等在树中叶子节点和非叶子节点的数据结构是一样的区别在于叶子节点存放的是实际的行数据而非叶子节点存放的是主键和页号索引结构不会影响单表最大行数也只是推荐值超过了这个值可能会导致树层级更高影响查询性能面试官事务中的隔离性是如何保证的呢你解释一下候选人事务的隔离性是由锁和实现的其中的意思是多版本并发控制指维护一个数据的多个版本使得读写操作没有冲突它的底层实现主要是分为了三个部分第一个是隐藏字段第二个是日志第三个是读视图隐藏字段是指在中给每个表都设置了隐藏字段有一个是事务记录每一次操作的事务是自增的另一个字段是回滚指针指向上一个版本的事务版本记录地址主要的作用是记录回滚日志存储老版本数据在内部会形成一个版本链在多个事务并行操作某一行记录记录不同事务修改数据的版本通过指针形成一个链表解决的是一个事务查询选择版本的问题在内部定义了一些匹配规则和当前的一些事务判断该访问那个版本的数据不同的隔离级别快照读是不一样的最终的访问的结果不一样如果是隔离级别每一次执行快照读时生成如果是隔离级别仅在事务中第一次执行快照读时生成后续复用面试官主从同步原理候选人主从复制的核心就是二进制日志数据定义语言语句和数据操纵语言语句它的步骤是这样的第一主库在事务提交时会把数据变更记录在二进制日志文件中第二从库读取主库的二进制日志文件写入到从库的中继日志第三从库重做中继日志中的事件将改变反映它自己的数据思考为什么不让从库直接读取主库的文件呢中继日志的作用是什么如果多个从库直接连接到主库并读取其这会增加主库的网络负载和磁盘压力如果从库失败可通过中继日志快速恢复到失败前的状态有助于加速从库的恢复过程由于中继日志是本地存储的因此读取速度通常更快面试官谈谈你对读写分离和分库分表的理解高频候选人读写分离何为读写分离见名思意根据读写分离的名字我们就可以知道读写分离主要是为了将对数据库的读写操作分散到不同的数据库节点上这样的话就能够小幅提升写性能大幅提升读性能一般情况下我们都会选择一主多从也就是一台主数据库负责写其他的从数据库负责读主库和从库之间会进行数据同步以保证从库中数据的准确性读写分离会带来什么问题如何解决读写分离对于提升数据库的并发非常有效但是同时也会引来一个问题主库和从库的数据存在延迟比如你写完主库之后主库的数据同步到从库是需要时间的这个时间差就导致了主库和从库的数据不一致性问题这也就是我们经常说的主从同步延迟解决方案强制将读请求路由到主库处理既然你从库的数据过期了那我就直接从主库读取嘛这种方案虽然会增加主库的压力但是实现起来比较简单也是我了解到的使用最多的一种方式延迟读取还有一些朋友肯定会想既然主从同步存在延迟那我就在延迟之后读取啊比如主从同步延迟那我就之后再读取数据这样多方便啊方便是方便但是也很扯淡不过如果你是这样设计业务流程就会好很多对于一些对数据比较敏感的场景你可以在完成写请求之后避免立即进行请求操作比如你支付成功之后跳转到一个支付成功的页面当你点击返回之后才返回自己的账户如何实现读写分离不论是使用哪一种读写分离具体的实现方案想要实现读写分离一般包含如下几步部署多台数据库选择一种的一台作为主数据库其他的一台或者多台作为从数据库保证主数据库和从数据库之间的数据是实时同步的系统将写请求交给主数据库处理读请求交给从数据库处理分库分表读写分离主要应对的是数据库读并发没有解决数据库存储问题试想一下如果一张表的数据量过大怎么办换言之我们该如何解决的存储压力呢答案之一就是分库分表什么情况下需要分库分表遇到下面几种场景可以考虑分库分表单表的数据达到千万级别以上数据库读写速度比较缓慢分表数据库中的数据占用的空间越来越大备份时间越来越长分库应用的并发量太大分库分库分表会带来什么问题呢引入分库分表之后会给系统带来什么挑战呢操作同一个数据库中的表分布在了不同的数据库中导致无法使用操作这样就导致我们需要手动进行数据的封装比如你在一个数据库中查询到一个数据之后再根据这个数据去另外一个数据库中找对应的数据事务问题同一个数据库中的表分布在不同的数据库中如果单个操作涉及到多个数据库那么数据库自带的事务就无法满足我们的要求了分布式分库之后数据遍布在不同服务器上的数据库数据库的自增主键已经没办法满足生成的主键唯一了我们如何为不同的数据节点生成全局唯一主键呢这个时候我们就需要为我们的系统引入分布式了相关阅读揭秘索引背后的秘密武器树为何力压跳表独领风骚',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-04-05 16:27:42',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 8 || hour >= 19
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/miahemu" title="GitHub"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://leetcode.cn/u/lu-ren-r41/" title="力扣"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="力扣"/><span class="back-menu-item-text">力扣</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://leetcode.cn/u/lu-ren-r41/" title="CSDN"><img class="back-menu-item-icon" src="https://image.anheyu.com/favicon.ico" alt="CSDN"/><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" href="https://miahemu.github.io/about/" title="个人简介"><img class="back-menu-item-icon" src="/img/favicon.ico" alt="个人简介"/><span class="back-menu-item-text">个人简介</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">和睦的拾光物语</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=9460279562&amp;server=tencent"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 小挂件</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/weather/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 天气</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://i.miji.bid/2025/03/23/eeafc8609ad2edbb8e7112ced837d7f4.jpeg" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://i.miji.bid/2025/03/23/eeafc8609ad2edbb8e7112ced837d7f4.jpeg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://i.miji.bid/2025/03/29/81b165cb796725599ea7e82472ce9896.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://i.miji.bid/2025/03/29/81b165cb796725599ea7e82472ce9896.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/JAVA%E9%9D%A2%E7%BB%8F/" style="font-size: 1.05rem;">JAVA面经<sup>12</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">数据结构与算法<sup>1</sup></a><a href="/tags/%E7%AC%94%E8%AF%95/" style="font-size: 1.05rem;">笔试<sup>9</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">计算机网络<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/JAVA%E9%9D%A2%E7%BB%8F/" itemprop="url">JAVA面经</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/JAVA%E9%9D%A2%E7%BB%8F/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>JAVA面经</span></a></span></div></div><h1 class="post-title" itemprop="name headline">MySQL相关面试题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-03-23T16:00:00.000Z" title="发表于 2025-03-24 00:00:00">2025-03-24</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-04-05T08:27:42.489Z" title="更新于 2025-04-05 16:27:42">2025-04-05</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">13k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>40分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL相关面试题"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为鸡毛换糖城"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>鸡毛换糖城</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://w.wallhaven.cc/full/ym/wallhaven-ym22lk.jpg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://miahemu.github.io/2025/03/24/MySQL%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/"><header><a class="post-meta-categories" href="/categories/JAVA%E9%9D%A2%E7%BB%8F/" itemprop="url">JAVA面经</a><a href="/tags/JAVA%E9%9D%A2%E7%BB%8F/" tabindex="-1" itemprop="url">JAVA面经</a><h1 id="CrawlerTitle" itemprop="name headline">MySQL相关面试题</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">玦尘</span><time itemprop="dateCreated datePublished" datetime="2025-03-23T16:00:00.000Z" title="发表于 2025-03-24 00:00:00">2025-03-24</time><time itemprop="dateCreated datePublished" datetime="2025-04-05T08:27:42.489Z" title="更新于 2025-04-05 16:27:42">2025-04-05</time></header><div class="note red anzhiyufont anzhiyu-icon-fan flat"><p>本文为原创内容，转载请注明出处并附带原文链接。感谢您的尊重与支持！</p>
</div>

<div class="tip sync"><p>你必须非常努力，才能看起来毫不费劲。</p>
</div>

<hr>
<h3 id="面试官：-数据库的三大范式"><a href="#面试官：-数据库的三大范式" class="headerlink" title="面试官： 数据库的三大范式"></a><strong>面试官：</strong> 数据库的三大范式</h3><p><strong>候选人：</strong></p>
<ol>
<li>每个列都不可拆分</li>
<li>在第一范式的基础上，非主键列完全依赖于主键，而不能是依赖于主键的一部分</li>
<li>在第二范式的基础上，非主键列只依赖于主键，不依赖于其他非主键列</li>
</ol>
<h3 id="面试官：-说一下外键约束"><a href="#面试官：-说一下外键约束" class="headerlink" title="面试官： 说一下外键约束"></a><strong>面试官：</strong> 说一下外键约束</h3><p><strong>候选人：</strong></p>
<p>外键约束的作用是维护表与表之间的关系，确保数据的完整性和一致性。让我们举一个简单的例子：</p>
<p>假设你有两个表，一个是学生表，另一个是课程表，这两个表之间有一个关系，即一个学生可以选修多门课程，而一门课程也可以被多个学生选修。在这种情况下，我们可以在学生表中定义一个指向课程表的外键，如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> students (</span><br><span class="line">  id <span class="type">INT</span> <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">  name <span class="type">VARCHAR</span>(<span class="number">50</span>),</span><br><span class="line">  course_id <span class="type">INT</span>,</span><br><span class="line">  <span class="keyword">FOREIGN KEY</span> (course_id) <span class="keyword">REFERENCES</span> courses(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>这里，<code>students</code>表中的<code>course_id</code>字段是一个外键，它指向<code>courses</code>表中的<code>id</code>字段。这个外键约束确保了每个学生所选的课程在<code>courses</code>表中都存在，从而维护了数据的完整性和一致性。</p>
<p>如果没有定义外键约束，那么就有可能出现学生选了不存在的课程或者删除了一个课程而忘记从学生表中删除选修该课程的学生的情况，这会破坏数据的<strong>完整性和一致性</strong>。因此，使用外键约束可以帮助我们避免这些问题。</p>
<h3 id="面试官：-说一下binlog"><a href="#面试官：-说一下binlog" class="headerlink" title="面试官： 说一下binlog"></a><strong>面试官：</strong> 说一下binlog</h3><p><strong>候选人：</strong></p>
<p>binlog日志是MySQL数据库的一种日志记录机制，用于记录数据库的修改操作（如插入、更新、删除等），以便在需要时进行数据恢复、数据复制和数据同步等操作。</p>
<p>binlog日志的实现以下功能：</p>
<ul>
<li><strong>数据恢复</strong>：binlog日志可以用于回滚到之前的某个时间点，从而恢复数据。</li>
<li><strong>数据复制</strong>：binlog日志可以用于在主从数据库之间复制数据，从而实现数据的高可用和负载均衡等功能。</li>
</ul>
<p>MySQL的binlog日志有三种格式，分别是Statement格式、Row格式和Mixed格式。它们之间的区别如下：</p>
<ul>
<li><strong>STATEMENT</strong>：每一条修改数据的 SQL 都会被记录到 binlog 中（相当于记录了逻辑操作，所以针对这种格式， binlog 可以称为逻辑日志），主从复制中 slave 端再根据 SQL 语句重现；</li>
<li><strong>ROW</strong>：记录行数据最终被修改成什么样了（这种格式的日志，就不能称为逻辑日志了），不会出现 STATEMENT 下动态函数的问题。但 ROW 的缺点是每行数据的变化结果都会被记录，比如执行批量 update 语句，更新多少行数据就会产生多少条记录，使 binlog 文件过大；</li>
<li><strong>MIXED</strong>：包含了 STATEMENT 和 ROW 模式，它会根据不同的情况自动使用 ROW 模式和 STATEMENT 模式；</li>
</ul>
<hr>
<h3 id="面试官：MySQL-binlog，redolog和undolog的区别"><a href="#面试官：MySQL-binlog，redolog和undolog的区别" class="headerlink" title="面试官：MySQL binlog，redolog和undolog的区别"></a><strong>面试官</strong>：MySQL binlog，redolog和undolog的区别</h3><p><strong>候选人</strong>：</p>
<ul>
<li><p><strong>binlog</strong>（二进制日志）：记录所有对MySQL数据库的修改操作，包括插入、更新和删除等。binlog主要用于数据恢复到指定时间点或者指定事务。可以使用<code>mysql binlog</code>命令将binlog文件解析成SQL语句，从而恢复MySQL数据库的状态。</p>
</li>
<li><p><strong>redolog</strong>（重做日志）：记录所有对MySQL数据库的修改操作，但是只记录了<strong>物理操作</strong>，比如页的修改。redolog主要用于MySQL的崩溃恢复，即在MySQL崩溃后，通过重做日志，将数据库恢复到最近一次提交的状态。</p>
</li>
<li><p><strong>undolog</strong>（回滚日志）：用于记录事务的<strong>回滚操作</strong>，即在事务执行过程中，如果发生了回滚，会将回滚操作记录到undolog中。undolog主要用于 MySQL 的回滚操作，比如使用ROLLBACK语句回滚事务。undolog是InnoDB存储引擎的特有日志，不同于其他存储引擎。</p>
</li>
</ul>
<hr>
<h3 id="面试官：-MyISAM和InnoDB区别"><a href="#面试官：-MyISAM和InnoDB区别" class="headerlink" title="面试官： MyISAM和InnoDB区别"></a><strong>面试官：</strong> MyISAM和InnoDB区别</h3><p><strong>候选人：</strong></p>
<ol>
<li><strong>是否⽀持⾏级锁</strong> : MyISAM 只有表级锁(table-level locking)，⽽InnoDB ⽀持⾏级锁(rowlevel locking)和表级锁,默认为⾏级锁。</li>
</ol>
<blockquote>
<p>补充：<strong>行级锁和表级锁？</strong></p>
<p><strong>行级锁</strong>是一种细粒度的锁机制，它只锁定对特定行的访问。这意味着当一个事务正在更新或删除一个表中的某一行时，其他事务不能同时更新或删除这一行，但它们仍然可以读取这一行或者修改表中的其他行。</p>
<ul>
<li>这种锁的优点是它提供了更好的并发性能，因为多个事务可以在同一时间内操作表的不同部分。</li>
<li>缺点是它可能会导致更高的开销，因为系统需要跟踪哪些行已经被锁定。</li>
</ul>
<p><strong>表级锁</strong>是一种粗粒度的锁机制，它锁定整个表。当一个事务对某个表进行读写操作时，它可以阻止其他事务对该表的任何访问，直到锁被释放。</p>
<ul>
<li>这种锁的优点是实现简单，管理成本相对较低。</li>
<li>缺点是由于锁住了整个表，所以并发能力较差，尤其是在需要频繁并发读写的情况下。</li>
</ul>
</blockquote>
<ol start="2">
<li><p><strong>是否⽀持事务和崩溃后的安全恢复：</strong> <strong>MyISAM</strong> 强调的是性能，每次查询具有原⼦性,其执⾏速度⽐InnoDB类型更快，但是不提供事务⽀持。但是<strong>InnoDB</strong> 提供事务⽀持事务，外部键等⾼级数据库功能。 具有提交事务(commit)、回滚(rollback)和崩溃修复能⼒。</p>
</li>
<li><p><strong>是否⽀持外键：</strong> MyISAM不⽀持，⽽InnoDB⽀持。</p>
</li>
<li><p><strong>是否⽀持MVCC</strong> ：仅 InnoDB ⽀持。应对⾼并发事务, MVCC⽐单纯的加锁更⾼效；MVCC只在 READ COMMITTED 和 REPEATABLE READ 两个隔离级别下⼯作；MVCC可以使⽤ 乐观锁 和 悲观锁来实现。</p>
</li>
</ol>
<blockquote>
<p>《MySQL高性能》上⾯有⼀句话这样写到：</p>
<p>不要轻易相信“MyISAM⽐InnoDB快”之类的经验之谈，这个结论往往不是绝对的。在很多我们已知场景中，InnoDB的速度都可以让MyISAM望尘莫及，尤其是⽤到了聚簇索引，或者需要访问的数据都可以放⼊内存的应⽤。</p>
</blockquote>
<blockquote>
<p>补充：<strong>乐观锁与悲观锁？</strong></p>
<p>悲观锁 ：基于假设：当事务要对某个数据进⾏操作时，认为很可能会发⽣冲突。因此，<strong>在事务开始时就对数据进⾏锁定</strong>，阻⽌其他事务同时对其进⾏修改，直到当前事务完成。这种⽅式虽然能够保证数据的⼀致性和准确性，但由于锁的存在，可能会导致其他事务等待，增加了系统开销。</p>
<p>乐观锁 ：基于另⼀种假设：认为事务之间发⽣冲突的概率较低，因此<strong>在读取数据时不⽴即加锁</strong>，⽽是允许多个事务同时读取数据。当事务尝试提交更改时，会检查在此期间是否有其他事务修改过相同的数据。如果有冲突，则当前事务失败，可能需要回滚并重新开始。<strong>乐观锁通常通过版本号或时间戳来检测数据是否已被修改。</strong></p>
</blockquote>
<hr>
<h3 id="面试官：-MySQL（以-InnoDB-为例）实现的锁类型？"><a href="#面试官：-MySQL（以-InnoDB-为例）实现的锁类型？" class="headerlink" title="面试官： MySQL（以 InnoDB 为例）实现的锁类型？"></a><strong>面试官：</strong> MySQL（以 InnoDB 为例）实现的锁类型？</h3><p><strong>候选人：</strong> 大体上可以从两个层面回答：<strong>表级锁</strong>（读写锁、意向锁）和<strong>行级锁</strong>（记录锁、间隙锁、临键锁）。</p>
<ol>
<li><p><strong>表级锁：</strong></p>
<ul>
<li><p>读写锁 (Read&#x2F;Write Lock)。主要用于锁定整个表，分为<strong>读锁</strong>（Read Lock）和<strong>写锁</strong>（Write Lock）。通过 <code>LOCK TABLES</code> 命令手动触发。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOCK TABLES table_name READ;</span><br><span class="line">LOCK TABLES table_name WRITE;</span><br></pre></td></tr></table></figure>
</li>
<li><p>意向锁 (Intention Lock)。由 InnoDB 自动管理，用于协调表级锁和行级锁之间的关系。表示事务打算对表中的某些行加锁，而不是直接锁住数据。</p>
</li>
</ul>
</li>
<li><p><strong>行级锁：</strong></p>
<ul>
<li><p>记录锁 (Record Lock)。记录锁是一种行级锁，精确锁住索引记录上的某一行，不涉及范围。只在 InnoDB 中实现。</p>
</li>
<li><p>间隙锁 (Gap Lock)。间隙锁锁住索引记录之间的“间隙”，防止其他事务在该范围内插入新记录。是 InnoDB 在可重复读隔离级别下的默认行锁机制。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">20</span> <span class="keyword">AND</span> age <span class="operator">&lt;</span> <span class="number">30</span> <span class="keyword">FOR</span> <span class="keyword">UPDATE</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>临键锁 (Next-Key Lock)。临键锁是记录锁和间隙锁的组合，锁住一个索引记录以及它前面的间隙，形成<code>左开右闭区间 (a, b]</code>。同时也是 InnoDB 在<strong>可重复读 (Repeatable Read) 隔离级别下防止幻读</strong>的关键机制。</p>
</li>
</ul>
</li>
</ol>
<hr>
<h3 id="面试官：-MySQL中，如何定位慢查询-（高频）"><a href="#面试官：-MySQL中，如何定位慢查询-（高频）" class="headerlink" title="面试官： MySQL中，如何定位慢查询?（高频）"></a><strong>面试官：</strong> MySQL中，如何定位慢查询?<code>（高频）</code></h3><p><strong>候选人：</strong></p>
<p>嗯~，我们当时做压测的时候有的接口非常的慢，接口的响应时间超过了2秒以上，因为我们当时的系统部署了运维的监控系统<strong>Skywalking</strong> ，在展示的报表中可以看到是哪一个接口比较慢，并且可以分析这个接口哪部分比较慢，这里可以看到SQL的具体的执行时间，所以可以定位是哪个sql出了问题。</p>
<p>如果，项目中没有这种运维的监控系统，其实在MySQL中也提供了<strong>慢日志查询</strong>的功能，可以在MySQL的系统配置文件中开启这个慢日志的功能，并且也可以设置SQL执行超过多少时间来记录到一个日志文件中，我记得上一个项目配置的是2秒，只要SQL执行的时间超过了2秒就会记录到日志文件中，我们就可以在日志文件找到执行比较慢的SQL了。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  启用慢查询日志</span></span><br><span class="line">slow_query_log = 1 </span><br><span class="line"><span class="comment"># 定义慢查询的时间阈值，默认为10秒</span></span><br><span class="line">long_query_time = 2</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="面试官：-那这个SQL语句执行很慢-如何分析呢？（高频）"><a href="#面试官：-那这个SQL语句执行很慢-如何分析呢？（高频）" class="headerlink" title="面试官： 那这个SQL语句执行很慢, 如何分析呢？（高频）"></a><strong>面试官：</strong> 那这个SQL语句执行很慢, 如何分析呢？<code>（高频）</code></h3><p><strong>候选人：<strong>如果一条sql执行很慢的话，我们通常会使用mysql自动的</strong>执行计划explain</strong>来去查看这条sql的执行情况。</p>
<ul>
<li>比如在这里面可以通过 <strong>key(实际使用的索引)</strong> 和 <strong>key_len(使用的索引长度)</strong> 检查是否命中了索引，如果本身已经添加了索引，也可以判断索引是否有失效的情况。</li>
<li>第二个，可以通过<strong>type</strong>字段查看sql是否有进一步的优化空间，是否存在全索引扫描(INDEX)或全盘扫描(ALL)。</li>
<li>第三个可以通过<strong>extra</strong>建议来判断，是否出现了回表的情况，如果出现了，可以尝试添加索引或修改返回字段来修复。</li>
</ul>
<p><code>SQL案例：</code></p>
<p>假设我们有一个数据库表 <code>employees</code>，结构如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> employees (</span><br><span class="line">    emp_no <span class="type">INT</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    birth_date <span class="type">DATE</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    first_name <span class="type">VARCHAR</span>(<span class="number">14</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    last_name <span class="type">VARCHAR</span>(<span class="number">16</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    gender ENUM(<span class="string">&#x27;M&#x27;</span>,<span class="string">&#x27;F&#x27;</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">    hire_date <span class="type">DATE</span> <span class="keyword">NOT NULL</span>,</span><br><span class="line">    <span class="keyword">PRIMARY KEY</span> (emp_no)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>现在我们想分析下面这个查询的执行计划，我们可以使用 <code>EXPLAIN</code> 如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> first_name <span class="operator">=</span> <span class="string">&#x27;John&#x27;</span> <span class="keyword">AND</span> last_name <span class="operator">=</span> <span class="string">&#x27;Doe&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>执行这条命令后，会得到一个结果集：</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://pic1.imgdb.cn/item/67e15ce50ba3d5a1d7e2a27d.png" alt="image-20250218230537025"></p>
<p>从这个例子中可以看出，因为 <code>first_name</code> 和 <code>last_name</code> 没有索引，所以MySQL需要对整个表进行全表扫描来查找符合条件的记录。这在数据量大时会非常低效。</p>
<h3 id="面试官：-一条SQL语句执行得很慢的原因有哪些？"><a href="#面试官：-一条SQL语句执行得很慢的原因有哪些？" class="headerlink" title="面试官： 一条SQL语句执行得很慢的原因有哪些？"></a><strong>面试官：</strong> 一条SQL语句执行得很慢的原因有哪些？</h3><p><strong>候选人：</strong> 分以下两种情况来讨论。</p>
<p>1、大多数情况是正常的，只是偶尔会出现很慢的情况。</p>
<p>2、在数据量不变的情况下，这条SQL语句一直以来都执行的很慢。</p>
<h4 id="一、针对偶尔很慢的情况"><a href="#一、针对偶尔很慢的情况" class="headerlink" title="一、针对偶尔很慢的情况"></a>一、针对偶尔很慢的情况</h4><p>一条 SQL 大多数情况正常，偶尔才能出现很慢的情况，针对这种情况，我觉得这条SQL语句的书写本身是没什么问题的，而是其他原因导致的，那会是什么原因呢？</p>
<ol>
<li><p><strong>数据库在刷新脏页（flush）我也无奈啊</strong></p>
<p>当我们要往数据库插入一条数据、或者要更新一条数据的时候，我们知道数据库会在<strong>内存</strong>中把对应字段的数据更新了，但是更新之后，这些更新的字段并不会马上同步持久化到<strong>磁盘</strong>中去，而是把这些更新的记录写入到 redo log 日记中去，等到空闲的时候，在通过 redo log 里的日记把最新的数据同步到<strong>磁盘</strong>中去。</p>
<blockquote>
<p>当内存数据页跟磁盘数据页内容不一致的时候，我们称这个内存页为“脏页”。内存数据写入到磁盘后，内存和磁盘上的数据页的内容就一致了，称为“干净页”。</p>
</blockquote>
<p><strong>刷脏页有下面2种场景：</strong></p>
<ul>
<li><strong>redo log写满了：</strong> redo log 里的容量是有限的，如果数据库一直很忙，更新又很频繁，这个时候 redo log 很快就会被写满了，这个时候就没办法等到空闲的时候再把数据同步到磁盘的，<strong>只能暂停其他操作</strong>，全身心来把数据同步到磁盘中去的，而这个时候，<strong>就会导致我们平时正常的SQL语句突然执行的很慢</strong>，所以说，数据库在在同步数据到磁盘的时候，就有可能导致我们的SQL语句执行的很慢了。</li>
<li><strong>内存不够用了：</strong> 如果一次查询较多的数据，恰好碰到所查数据页不在内存中时，需要申请内存，而此时恰好内存不足的时候就需要淘汰一部分内存数据页，如果是干净页，就直接释放，如果恰好是脏页就需要刷新脏页。</li>
</ul>
</li>
<li><p><strong>拿不到锁我能怎么办</strong>。</p>
<p>这个就比较容易想到了，我们要执行的这条语句，刚好这条语句涉及到的<strong>表</strong>，别人在用，并且加锁了，我们拿不到锁，只能慢慢等待别人释放锁了。或者表没有加锁，但要使用到的某一行被加锁了，这个时候，我也没办法啊。</p>
<p>如果要判断是否真的在等待锁，我们可以用 <strong>show processlist</strong>这个命令来查看当前的状态。</p>
</li>
</ol>
<h4 id="二、针对一直都这么慢的情况"><a href="#二、针对一直都这么慢的情况" class="headerlink" title="二、针对一直都这么慢的情况"></a>二、针对一直都这么慢的情况</h4><p>如果在数据量一样大的情况下，这条 SQL 语句每次都执行的这么慢，那就就要好好考虑下你的 SQL 书写了，下面我们来分析下哪些原因会导致我们的 SQL 语句执行的很不理想。</p>
<p>我们先来假设我们有一个表，表里有下面两个字段,分别是主键 id，和两个普通字段 c 和 d。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE TABLE</span> `t` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT NULL</span>,</span><br><span class="line">  `c` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `d` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY KEY</span> (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB;</span><br></pre></td></tr></table></figure>

<ol>
<li><p><strong>没用到索引</strong></p>
<p><strong>（1）、字段没有索引</strong></p>
<p>刚好 c 字段上没有索引，只能走全表扫描了，体验不会索引带来的乐趣了，所以，这会导致这条查询语句很慢。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="number">100</span> <span class="operator">&lt;</span>c <span class="keyword">and</span> c <span class="operator">&lt;</span> <span class="number">100000</span>;</span><br></pre></td></tr></table></figure>

<p><strong>（2）、字段有索引，但却没有用索引</strong></p>
<p>好吧，这个时候你给 c 这个字段加上了索引，然后又查询了一条语句:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> c <span class="operator">-</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p>但是这样子在查询的时候会用索引查询吗？</p>
<p>答是不会，如果我们在字段的左边做了运算，那么很抱歉，在查询的时候，就不会用上索引了，所以呢，大家要注意这种<strong>字段上有索引，但由于自己的疏忽，导致系统没有使用索引</strong>的情况了。</p>
<p>正确的查询应该如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> c <span class="operator">=</span> <span class="number">1000</span> <span class="operator">+</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>有人可能会说，右边有运算就能用上索引？难道数据库就不会自动帮我们优化一下，自动把 c - 1&#x3D;1000 自动转换为 c &#x3D; 1000+1。</p>
<p>不好意思，确实不会帮你，所以，你要注意了。</p>
<p><strong>（3）、函数操作导致没有用上索引</strong></p>
<p>如果我们在查询的时候，对字段进行了函数操作，也是会导致没有用上索引的，例如</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> pow(c,<span class="number">2</span>) <span class="operator">=</span> <span class="number">1000</span>;</span><br></pre></td></tr></table></figure>

<p>这里只是做一个例子，假设函数 pow 是求 c 的 n 次方，实际上可能并没有 pow(c,2)这个函数。其实这个和上面在左边做运算也是很类似的。</p>
</li>
<li><p><strong>数据库自己选错索引了</strong></p>
<p>我们在进行查询操作的时候，例如:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t <span class="keyword">where</span> <span class="number">100</span> <span class="operator">&lt;</span> c <span class="keyword">and</span> c <span class="operator">&lt;</span> <span class="number">100000</span>;</span><br></pre></td></tr></table></figure>

<p>我们知道，主键索引和非主键索引是有区别的，主键索引存放的值是<strong>整行字段的数据</strong>，而非主键索引上存放的值不是整行字段的数据，而且存放<strong>主键字段的值</strong>。</p>
<p>也就是说，我们如果走 c 这个字段的索引的话，最后会查询到对应主键的值，然后，再根据主键的值走主键索引，查询到整行数据返回。</p>
<p>所以就算你在 c 字段上有索引，系统也并不一定会走 c 这个字段上的索引，而是有可能会直接扫描扫描全表，找出所有符合 100 &lt; c and c &lt; 100000 的数据。</p>
<blockquote>
<p><strong>为什么会这样呢？</strong></p>
<p>其实是这样的，系统在执行这条语句的时候，会进行预测：究竟是走 c 索引扫描的行数少，还是直接扫描全表扫描的行数少呢？显然，扫描行数越少当然越好了，因为扫描行数越少，意味着I&#x2F;O操作的次数越少。</p>
<p>如果是扫描全表的话，那么扫描的次数就是这个表的总行数了，假设为 n；而如果走索引 c 的话，我们通过索引 c 找到主键之后，还得再通过主键索引来找我们整行的数据，也就是说，需要走<strong>两次索引</strong>。而且，我们也不知道符合 100 c &lt; and c &lt; 10000 这个条件的数据有多少行，万一这个表是全部数据都符合呢？这个时候意味着，<strong>走 c 索引不仅扫描的行数是 n，同时还得每行数据走两次索引</strong>。</p>
</blockquote>
<blockquote>
<p><strong>系统是有可能走全表扫描而不走索引的。那系统是怎么判断呢？</strong></p>
<p>判断来源于系统的预测，也就是说，如果要走 c 字段索引的话，系统会预测走 c 字段索引大概需要扫描多少行。如果<strong>预测</strong>到要扫描的行数很多，它可能就不走索引而直接扫描全表了。</p>
<p>那么问题来了，<strong>系统是怎么预测判断的呢？</strong></p>
<p>系统是通过<strong>索引的区分度</strong>来判断的，一个索引上不同的值越多，意味着出现相同数值的索引越少，意味着索引的区分度越高。我们也把区分度称之为<strong>基数</strong>，即区分度越高，基数越大。所以呢，基数越大，意味着符合 100 &lt; c and c &lt; 10000 这个条件的行数越少。</p>
<p>所以呢，一个索引的基数越大，意味着走索引查询越有优势。</p>
</blockquote>
<blockquote>
<p><strong>那么问题来了，怎么知道这个索引的基数呢？</strong></p>
<p>系统当然是不会遍历全部来获得一个索引的基数的，代价太大了，索引系统是通过遍历部分数据，也就是通过<strong>采样</strong>的方式，来预测索引的基数的。</p>
<p><strong>重点的来了</strong>，居然是采样，那就有可能出现<strong>失误</strong>的情况，也就是说，c 这个索引的基数实际上是很大的，但是采样的时候，却很不幸，把这个索引的基数预测成很小。例如你采样的那一部分数据刚好基数很小，然后就误以为索引的基数很小。<strong>然后系统就不走 c 索引了，直接走全部扫描了</strong>。</p>
</blockquote>
</li>
</ol>
<p>所以呢，说了这么多，得出结论：<strong>由于统计的失误，导致系统没有走索引，而是走了全表扫描</strong>，而这，也是导致我们 SQL 语句执行的很慢的原因。</p>
<p>不过呢，我们有时候也可以通过强制走索引的方式来查询，例如:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> t force index(a) <span class="keyword">where</span> c <span class="operator">&lt;</span> <span class="number">100</span> <span class="keyword">and</span> c <span class="operator">&lt;</span> <span class="number">100000</span>;</span><br></pre></td></tr></table></figure>

<p>我们也可以通过:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> index <span class="keyword">from</span> t;</span><br></pre></td></tr></table></figure>

<p>来查询索引的基数和实际是否符合，如果和实际很不符合的话，我们可以重新来统计索引的基数，可以用这条命令:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">analyze <span class="keyword">table</span> t;</span><br></pre></td></tr></table></figure>

<p>来重新统计分析。</p>
<p><strong>既然会预测错索引的基数，这也意味着，当我们的查询语句有多个索引的时候，系统有可能也会选错索引</strong>，这也可能是 SQL 执行的很慢的一个原因。</p>
<p>​	</p>
<h3 id="面试官：-MySQL中-SQL-查询和更新语句的执行流程？"><a href="#面试官：-MySQL中-SQL-查询和更新语句的执行流程？" class="headerlink" title="面试官： MySQL中 SQL 查询和更新语句的执行流程？"></a><strong>面试官：</strong> MySQL中 SQL 查询和更新语句的执行流程？</h3><p><strong>候选人：</strong></p>
<h4 id="一、-MySQL-基础架构分析"><a href="#一、-MySQL-基础架构分析" class="headerlink" title="一、 MySQL 基础架构分析"></a>一、 MySQL 基础架构分析</h4><p>下图是 MySQL 的一个简要架构图，从下图你可以很清晰的看到用户的 SQL 语句在 MySQL 内部是如何执行的。</p>
<ul>
<li><p><strong>连接器：</strong> 身份认证和权限相关(登录 MySQL 的时候)。</p>
</li>
<li><p><strong>查询缓存：</strong> 执行查询语句的时候，会先查询缓存（MySQL 8.0 版本后移除，<strong>缓存虽然能够提升数据库的查询性能，但是缓存同时也带来了额外的开销，每次查询后都要做⼀次缓存操作，失效后还要销毁。</strong>）</p>
</li>
<li><p><strong>分析器：</strong> 没有命中缓存的话，SQL 语句就会经过分析器，分析器说白了就是要先看你的 SQL 语句要干嘛，再检查你的 SQL 语句语法是否正确。</p>
</li>
<li><p><strong>优化器：</strong> 按照 MySQL 认为最优的方案去执行。</p>
</li>
<li><p><strong>执行器：</strong> 执行具体的SQL语句之前会校验该用户有没有权限，如果没有权限，就会返回错误信息，如果有权限，就会去调用存储引擎的接口，返回接口执行的结果。</p>
</li>
</ul>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://pic1.imgdb.cn/item/67e15d2c0ba3d5a1d7e2a28f.png" alt="image-20250219223554794"></p>
<p>简单来说 MySQL 主要分为 Server 层和存储引擎层：</p>
<ul>
<li><strong>Server 层</strong>：主要包括连接器、查询缓存、分析器、优化器、执行器等，所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图，函数等，还有一个通用的日志模块 binlog 日志模块。</li>
<li><strong>存储引擎</strong>：主要负责数据的存储和读取，采用可以替换的插件式架构，支持 InnoDB、MyISAM、Memory 等多个存储引擎，其中 InnoDB 引擎有自带的redo log日志模块。<strong>现在最常用的存储引擎是 InnoDB，它从 MySQL 5.5 版本开始就被当做默认存储引擎了。</strong></li>
</ul>
<h4 id="二、语句分析"><a href="#二、语句分析" class="headerlink" title="二、语句分析"></a>二、语句分析</h4><ol>
<li><p><strong>查询语句（SELECT）</strong></p>
<p>我们先分析下查询语句，语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_student  A <span class="keyword">where</span> A.age<span class="operator">=</span><span class="string">&#x27;18&#x27;</span> <span class="keyword">and</span> A.name<span class="operator">=</span><span class="string">&#x27; 张三 &#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>结合上面的说明，我们分析下这个语句的执行流程：</p>
<ul>
<li>先检查该语句是否有权限，如果没有权限，直接返回错误信息，如果有权限，在 MySQL8.0 版本以前，会先查询缓存，如果有直接返回，如果没有，执行下一步。</li>
<li>通过分析器进行词法分析，提取 SQL 语句的关键元素，比如提取上面这个语句是查询 select，提取需要查询的表名为 tb_student，需要查询所有的列，查询条件是这个表的 id&#x3D;’1’。然后判断这个 SQL 语句是否有语法错误，比如关键词是否正确等等，如果检查没问题就执行下一步。</li>
<li>接下来就是优化器进行确定执行方案，上面的 SQL 语句，可以有两种执行方案：a.先查询学生表中姓名为“张三”的学生，然后判断是否年龄是 18。b.先找出学生中年龄 18 岁的学生，然后再查询姓名为“张三”的学生。那么优化器根据自己的优化算法进行选择执行效率最好的一个方案（优化器认为，有时候不一定最好）。那么确认了执行计划后就准备开始执行了。</li>
<li>进行权限校验，如果没有权限就会返回错误信息，如果有权限就会调用存储引擎接口，返回引擎的执行结果。</li>
</ul>
</li>
<li><p><strong>更新语句（UPDATE、INSERT、DELETE）</strong></p>
<p>接下来我们看看一条更新语句如何执行的呢？SQL 语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> tb_student A <span class="keyword">set</span> A.age<span class="operator">=</span><span class="string">&#x27;19&#x27;</span> <span class="keyword">where</span> A.name<span class="operator">=</span><span class="string">&#x27; 张三 &#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>其实这条语句也基本上会沿着上一个查询的流程走，只不过执行更新的时候肯定要记录日志，这就会引入日志模块了，MySQL 自带的日志模块是 <strong>binlog（归档日志）</strong> ，所有的存储引擎都可以使用，我们常用的 InnoDB 引擎还自带了一个日志模块 <strong>redo log（重做日志）</strong>，我们就以 InnoDB 模式下来探讨这个语句的执行流程。流程如下：</p>
<ul>
<li>先查询到张三这一条数据，不会走查询缓存，因为更新语句会导致与该表相关的查询缓存失效。</li>
<li>然后拿到查询的语句，把 age 改为 19，然后调用存储引擎 API 接口，写入这一行数据，InnoDB 引擎把数据保存在内存中，同时记录 redo log，此时 redo log 进入 <strong>prepare（预提交）</strong> 状态，然后告诉执行器，执行完成了，随时可以提交。</li>
<li>执行器收到通知后记录 binlog，然后调用存储引擎接口，提交 redo log 为提交状态。</li>
<li>更新完成。</li>
</ul>
<blockquote>
<p><strong>这里肯定有同学会问，为什么要用两个日志模块，用一个日志模块不行吗?</strong></p>
<p>并不是说只用一个日志模块不可以，只是 InnoDB 引擎就是通过 redo log 来支持事务的。那么，又会有同学问，我用两个日志模块，但是不要这么复杂行不行，为什么 redo log 要引入 prepare 预提交状态？这里我们用反证法来说明下为什么要这么做？</p>
<ul>
<li><strong>先写 redo log 直接提交，然后写 binlog</strong>，假设写完 redo log 后，机器挂了，binlog 日志没有被写入，那么机器重启后，这台机器会通过 redo log 恢复数据，但是这个时候 binlog 并没有记录该数据，后续进行机器备份的时候，就会丢失这一条数据，同时主从同步也会丢失这一条数据。</li>
<li><strong>先写 binlog，然后写 redo log</strong>，假设写完了 binlog，机器异常重启了，由于redo log没有记录，本机是无法恢复这一条记录的，但是 binlog 又有记录，那么和上面同样的道理，就会产生数据不一致的情况。</li>
</ul>
<p>如果采用 redo log 两阶段提交的方式就不一样了，写完 binlog 后，然后再提交 redo log 就会防止出现上述的问题，从而保证了<strong>数据的一致性</strong>。</p>
<p>那么问题来了，有没有一个极端的情况呢？假设 <strong>redo log 处于预提交状态，binlog 也已经写完了</strong>，这个时候发生了异常重启会怎么样呢？这个就要依赖于 MySQL 的处理机制了，MySQL 的处理过程如下：</p>
<ul>
<li>判断 redo log 是否完整，如果判断是完整的，就立即提交。</li>
<li>如果 redo log 只是预提交但不是 commit 状态，这个时候就会去判断 binlog 是否完整，如果完整就提交 redo log, 不完整就回滚事务。</li>
</ul>
<p>这样就解决了数据一致性的问题。</p>
</blockquote>
</li>
</ol>
<h3 id="面试官：-IP地址如何在数据库里存储？"><a href="#面试官：-IP地址如何在数据库里存储？" class="headerlink" title="面试官： IP地址如何在数据库里存储？"></a><strong>面试官：</strong> IP地址如何在数据库里存储？</h3><p><strong>候选人：</strong> IPv4 地址是一个 32 位的二进制数，通常以点分十进制表示法呈现，例如 <code>192.168.1.1</code>。</p>
<p>1.<strong>字符串类型的存储方式</strong>：直接将 IP 地址作为字符串存储在数据库中，比如可以用 <code>VARCHAR(15)</code>来存储。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建一个表，使用VARCHAR类型存储IPv4地址</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> ip_records (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    ip_address <span class="type">VARCHAR</span>(<span class="number">15</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> ip_records (ip_address) <span class="keyword">VALUES</span> (<span class="string">&#x27;192.168.1.1&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>优点</strong>：直观易懂，方便直接进行数据的插入、查询和显示，不需要进行额外的转换操作。</p>
</li>
<li><p><strong>缺点</strong>：占用存储空间较大，字符串比较操作的性能相对较低，不利于进行范围查询。</p>
</li>
</ul>
<p>2.<strong>整数类型的存储方式：</strong> 将 IPv4 地址转换为 32 位无符号整数进行存储，常用的数据类型有 <code>INT UNSIGNED</code>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建一个表，使用INT UNSIGNED类型存储IPv4地址</span></span><br><span class="line"><span class="keyword">CREATE TABLE</span> ip_records (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY KEY</span>,</span><br><span class="line">    ip_address <span class="type">INT</span> UNSIGNED</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入数据，需要先将IP地址转换为整数</span></span><br><span class="line"><span class="keyword">INSERT INTO</span> ip_records (ip_address) <span class="keyword">VALUES</span> (INET_ATON(<span class="string">&#x27;192.168.1.1&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查询时将整数转换回IP地址</span></span><br><span class="line"><span class="keyword">SELECT</span> INET_NTOA(ip_address) <span class="keyword">FROM</span> ip_records;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>优点</strong>：占用存储空间小，整数比较操作的性能较高，便于进行范围查询。</p>
</li>
<li><p><strong>缺点</strong>：需要进行额外的转换操作，不够直观，增加了开发的复杂度。</p>
</li>
</ul>
<h3 id="面试官：-什么是索引-（高频）"><a href="#面试官：-什么是索引-（高频）" class="headerlink" title="面试官： 什么是索引 （高频）"></a><strong>面试官：</strong> 什么是索引 <code>（高频）</code></h3><p><strong>候选人：</strong> 嗯，索引是帮助MySQL<strong>高效获取数据</strong>的数据结构，主要是用来<strong>提高数据检索的效率</strong>，<strong>降低数据库的IO成本</strong>，同时通过索引列对数据进行排序，<strong>降低数据排序的成本</strong>，也能降低了CPU的消耗。</p>
<h3 id="面试官：-索引的底层数据结构了解过嘛-（高频）"><a href="#面试官：-索引的底层数据结构了解过嘛-（高频）" class="headerlink" title="面试官： 索引的底层数据结构了解过嘛 ? （高频）"></a><strong>面试官：</strong> 索引的底层数据结构了解过嘛 ? <code>（高频）</code></h3><p><strong>候选人：</strong> MySQL的默认的存储引擎InnoDB采用的<strong>B+树</strong>的数据结构来存储索引，选择B+树的主要的原因是：</p>
<ul>
<li><p>第一阶数更多，路径更短，这减少了树的高度，从而缩短了从根到叶子节点的路径长度，从而提高了检索效率。</p>
</li>
<li><p>第二个磁盘读写代价B+树更低，只有叶子节点存储实际的数据记录，而所有非叶子节点保存索引键值和指针信息。</p>
</li>
<li><p>第三是B+树便于扫库和区间查询，所有的叶子节点都通过双向链表连接在一起。</p>
</li>
</ul>
<h3 id="面试官：-B树和B-树的区别是什么呢？（高频）"><a href="#面试官：-B树和B-树的区别是什么呢？（高频）" class="headerlink" title="面试官： B树和B+树的区别是什么呢？（高频）"></a><strong>面试官：</strong> B树和B+树的区别是什么呢？<code>（高频）</code></h3><p><strong>候选人</strong>：</p>
<p>第一：在B树中，非叶子节点和叶子节点都会存放数据，而B+树的所有的数据都会出现在叶子节点，在查询的时候，B+树查找效率更加稳定。</p>
<p>第二：在进行范围查询的时候，B+树效率更高，因为B+树都在叶子节点存储，并且叶子节点是一个双向链表。</p>
<h3 id="面试官：-什么是聚簇索引？什么是非聚簇索引（辅助索引）"><a href="#面试官：-什么是聚簇索引？什么是非聚簇索引（辅助索引）" class="headerlink" title="面试官： 什么是聚簇索引？什么是非聚簇索引（辅助索引） ?"></a><strong>面试官：</strong> 什么是聚簇索引？什么是非聚簇索引（辅助索引） ?</h3><p><strong>候选人：</strong></p>
<ul>
<li><p>聚簇索引主要是指<strong>数据与索引放到一块</strong>，B+树的叶子节点保存了整行数据，<strong>有且只有一个</strong>，这意味着表中的数据行按照索引键的顺序存放，通常这个索引是主键索引。</p>
</li>
<li><p>非聚簇索引（辅助索引）主要是<strong>数据与索引分开存储</strong>，B+树的叶子节点保存对应的主键值，<strong>可以有多个</strong>，当用户定义额外的索引时（如唯一索引、普通索引等），这些索引就是非聚簇索引。</p>
</li>
</ul>
<h3 id="面试官：-知道什么是回表查询嘛"><a href="#面试官：-知道什么是回表查询嘛" class="headerlink" title="面试官： 知道什么是回表查询嘛 ?"></a><strong>面试官：</strong> 知道什么是回表查询嘛 ?</h3><p><strong>候选人：<strong>嗯，其实跟刚才介绍的聚簇索引和非聚簇索引是有关系的，回表的意思就是通过</strong>辅助索引找到对应的主键值</strong>，然后再<strong>通过主键值找到聚集索引中所对应的整行数据</strong>，这个过程就是回表。</p>
<p>【<strong>备注</strong>：如果面试官直接问回表，则需要先介绍聚簇索引和非聚簇索引】</p>
<h3 id="面试官：-MySQL的主键索引为什么用自增ID，不使用UUID？"><a href="#面试官：-MySQL的主键索引为什么用自增ID，不使用UUID？" class="headerlink" title="面试官： MySQL的主键索引为什么用自增ID，不使用UUID？"></a><strong>面试官：</strong> MySQL的主键索引为什么用自增ID，不使用UUID？</h3><p><strong>候选人：</strong></p>
<p>一般情况下，MySQL推荐使用自增ID，因为在MySQL的InnoDB存储引擎中，主键索引就是聚簇索引，主键索引的B+树的叶子结点<strong>按顺序存储</strong>主键值和数据，如果主键索引是自增ID，只需按顺序往后排列即可；如果是UUID，ID是随机生成的，在数据插入时会造成大量的数据移动，产生大量碎片。</p>
<h3 id="面试官：-知道什么叫覆盖索引嘛"><a href="#面试官：-知道什么叫覆盖索引嘛" class="headerlink" title="面试官： 知道什么叫覆盖索引嘛 ?"></a><strong>面试官：</strong> 知道什么叫覆盖索引嘛 ?</h3><p><strong>候选人：</strong></p>
<p>如果一个索引包含了查询语句中所需要的所有列（索引全部命中了），那么这个索引就是一个覆盖索引。如果我们使用id查询，它会直接走覆盖索引查询，一次索引扫描，直接返回数据，性能高。</p>
<p>如果按照<strong>辅助索引</strong>查询数据的时候，返回的列中没有创建索引，有可能会触发回表查询，尽量避免使用<code>select *</code>，尽量在返回的列中都包含添加索引的字段。</p>
<h3 id="面试官：-MySQL超大分页怎么处理"><a href="#面试官：-MySQL超大分页怎么处理" class="headerlink" title="面试官： MySQL超大分页怎么处理 ?"></a><strong>面试官：</strong> MySQL超大分页怎么处理 ?</h3><p><strong>候选人：</strong> 超大分页一般都是在数据量比较大时，我们使用了limit分页查询，并且需要对数据进行排序，这个时候效率就很低。例如我们执行<code>limit 900000，10</code>，此时MySQL需排序前900010条记录，仅仅返回900000-900010的记录，其他记录要丢弃，这时查询排序的代价就非常大了。</p>
<p>不过我们可以采用<strong>覆盖索引和子查询</strong>来解决。先分页查询数据的<strong>id字段</strong>，确定了id之后，再用<strong>子查询</strong>来过滤，只查询这个id列表中的数据就可以了。因为查询id的时候，走的覆盖索引，所以效率可以提升很多。</p>
<h3 id="面试官：-什么情况下索引会失效-（高频）"><a href="#面试官：-什么情况下索引会失效-（高频）" class="headerlink" title="面试官： 什么情况下索引会失效 ?（高频）"></a><strong>面试官：</strong> 什么情况下索引会失效 ?<code>（高频）</code></h3><p><strong>候选人：</strong> 嗯，这个情况比较多，我说一些自己的经验，以前遇到过的，比如：</p>
<ul>
<li><p>索引在使用的时候没有遵循<strong>最左匹配法则</strong>。</p>
<blockquote>
<p>假设有一个复合索引 <code>idx(a, b, c)</code>，其中 <code>a</code> 是最左边的列。</p>
<p>查询语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> c <span class="operator">=</span> <span class="string">&#x27;value&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>在这种情况下，虽然有复合索引 <code>idx(a, b, c)</code>，但是因为查询条件没有从索引的最左侧开始，所以无法利用这个索引。</p>
</blockquote>
</li>
<li><p>模糊查询，如果%号在前面也会导致索引失效。</p>
<blockquote>
<p>假设有一个索引 <code>idx(column_a)</code>。</p>
<p>查询语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> column_a <span class="keyword">LIKE</span> <span class="string">&#x27;%abc&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>这里 <code>%</code> 放在了模式字符串的开头，意味着匹配任意数量的字符后跟着 <code>abc</code>。由于 <code>%</code> 放在了开头，数据库无法利用索引来加速查询，因为任何字符都可能匹配，所以只能进行全面扫描。</p>
</blockquote>
</li>
<li><p>如果在添加索引的字段上进行了<strong>运算操作</strong>或者<strong>类型转换</strong>也都会导致索引失效。</p>
<blockquote>
<p>假设有一个索引 <code>idx(column_b)</code>。</p>
<p>查询语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> column_b <span class="operator">+</span> <span class="number">1</span> <span class="operator">=</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<p>这里对 <code>column_b</code> 进行了加法运算，导致索引 <code>idx(column_b)</code> 无法被使用。同样，如果对 <code>column_b</code> 进行类型转换，例如 <code>WHERE CAST(column_b AS CHAR) = &#39;5&#39;</code>，也会导致索引失效。</p>
</blockquote>
</li>
<li><p>如果使用了复合索引，中间使用了范围查询，右边的条件索引也会失效</p>
<blockquote>
<p>假设有一个复合索引 <code>idx(a, b, c)</code>。</p>
<p>查询语句如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> <span class="keyword">table</span> <span class="keyword">WHERE</span> a <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> b <span class="keyword">BETWEEN</span> <span class="number">10</span> <span class="keyword">AND</span> <span class="number">20</span> <span class="keyword">AND</span> c <span class="operator">=</span> <span class="string">&#x27;value&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>在这个查询中，虽然 <code>a</code> 和 <code>c</code> 的条件可以使用索引，但是由于 <code>b</code> 使用了范围查询 <code>BETWEEN</code>，导致 <code>c</code> 的条件无法使用索引加速查询。因此，尽管 <code>a</code> 和 <code>b</code> 的条件仍然可以使用部分索引，但是 <code>c</code> 的索引效果将被忽略。</p>
</blockquote>
</li>
<li><p>当查询中使用了 <code>IS NOT NULL</code> 时，索引可能会失效。虽然 MySQL 支持对 <code>IS NULL</code> 使用索引，但在很多情况下，特别是 <code>IS NOT NULL</code> 的查询，数据库可能会选择全表扫描，从而导致索引失效。</p>
</li>
</ul>
<p>通常情况下，想要判断出这条sql是否有索引失效的情况，可以使用<strong>explain</strong>执行计划来分析。</p>
<h3 id="面试官：-sql的优化的经验（慢查询优化）（高频）"><a href="#面试官：-sql的优化的经验（慢查询优化）（高频）" class="headerlink" title="面试官： sql的优化的经验（慢查询优化）（高频）"></a><strong>面试官：</strong> sql的优化的经验（慢查询优化）<code>（高频）</code></h3><p><strong>候选人：</strong> 嗯，这个在项目还是挺常见的，当然如果直说sql优化的话，我们会从这几方面考虑，比如</p>
<p>建表的时候、使用索引、sql语句的编写、主从复制，读写分离，还有一个是如果量比较大的话，可以考虑分库分表。</p>
<h3 id="面试官：-创建表的时候，你们是如何优化的呢？"><a href="#面试官：-创建表的时候，你们是如何优化的呢？" class="headerlink" title="面试官： 创建表的时候，你们是如何优化的呢？"></a><strong>面试官：</strong> 创建表的时候，你们是如何优化的呢？</h3><p><strong>候选人：</strong></p>
<ul>
<li>对于数值型字段，我们会根据预期的值域大小选择适当的类型，如 <code>TINYINT</code>、<code>SMALLINT</code>、<code>INT</code> 或 <code>BIGINT</code>。这样既可以节省存储空间，也能提高查询效率。</li>
<li>对于字符型字段，我们会在 <code>CHAR</code> 和 <code>VARCHAR</code> 之间作出区分。<code>CHAR</code> 适合固定长度的字符串，而 <code>VARCHAR</code> 更适用于长度可变的文本。对于非常大的文本字段，我们会考虑使用 <code>TEXT</code> 类型及其变体。</li>
</ul>
<h3 id="面试官：-那在使用索引的时候，是如何优化呢？（高频）"><a href="#面试官：-那在使用索引的时候，是如何优化呢？（高频）" class="headerlink" title="面试官： 那在使用索引的时候，是如何优化呢？（高频）"></a><strong>面试官：</strong> 那在使用索引的时候，是如何优化呢？<code>（高频）</code></h3><p><strong>候选人：</strong> 这个情况有很多，不过都有一个大前提，就是表中的数据要超过10万以上，我们才会创建索引，并且添加索引的字段是查询比较频繁的字段，一般也是像作为查询条件，排序字段或分组的字段这些。</p>
<p>还有就是，我们通常创建索引的时候都是使用复合索引来创建，一条sql的返回值，<strong>尽量使用覆盖索引</strong>，如果字段的区分度不高的话，我们也会把它放在<strong>组合索引</strong>后面的字段。</p>
<p>如果某一个字段的内容较长，我们会考虑使用<strong>前缀索引</strong>来使用，当然并不是所有的字段都要添加索引，这个索引的数量也要控制，因为添加索引也会导致新增改的速度变慢，维护成本大。</p>
<h3 id="面试官：-你平时对sql语句做了哪些优化呢？（高频）"><a href="#面试官：-你平时对sql语句做了哪些优化呢？（高频）" class="headerlink" title="面试官： 你平时对sql语句做了哪些优化呢？（高频）"></a><strong>面试官：</strong> 你平时对sql语句做了哪些优化呢？<code>（高频）</code></h3><p><strong>候选人：</strong> 嗯，这个也有很多，比如SELECT语句务必指明字段名称，不要直接使用select * ，还有就是要注意SQL语句避免造成索引失效的写法；如果是聚合查询，尽量用union all代替union ，union会多一次过滤，效率比较低；如果是表关联的话，尽量使用<strong>inner join</strong> ，不要使用<strong>left join &#x2F; right join</strong>，如必须使用，一定要以小表为驱动。</p>
<blockquote>
<p>补充：<strong>union all 和 union</strong></p>
<p><strong><code>UNION ALL</code></strong>：它会返回查询结果的所有行，包括重复的行。因此，它的执行速度通常更快，因为它不需要进行去重处理。</p>
<p><strong><code>UNION</code></strong>：它会去除查询结果中的重复行，然后返回最终结果。这意味着 <code>UNION</code> 在返回结果之前会进行去重处理，这一步骤可能会消耗更多的计算资源，因此执行速度较慢。</p>
</blockquote>
<blockquote>
<p>补充：<strong>以小表为驱动怎么理解？</strong></p>
<p>数据库在执行<strong>join</strong>操作时，通常会对驱动表进行扫描，并为驱动表中的每一行查找另一表中的匹配行。如果驱动表很大，那么这种操作可能会非常耗时。</p>
</blockquote>
<h3 id="面试官：-事务的特性是什么？可以详细说一下吗？"><a href="#面试官：-事务的特性是什么？可以详细说一下吗？" class="headerlink" title="面试官： 事务的特性是什么？可以详细说一下吗？"></a><strong>面试官：</strong> 事务的特性是什么？可以详细说一下吗？</h3><p><strong>候选人：</strong> ACID，分别指的是：<strong>原子性、一致性、隔离性、持久性</strong>；我举个例子：</p>
<p>A向B转账500，转账成功，A扣除500元，B增加500元，原子操作体现在要么都成功，要么都失败。</p>
<p>在转账的过程中，数据要一致，A扣除了500，B必须增加500。</p>
<p>在转账的过程中，隔离性体现在A向B转账，不能受其他事务干扰。</p>
<p>在转账的过程中，持久性体现在事务提交后，要把数据持久化（可以说是落盘操作）。</p>
<blockquote>
<p>MySQL InnoDB 引擎通过什么技术来保证事务的这四个特性的呢？</p>
<ul>
<li><p>原子性是通过 undo log（回滚日志） 来保证的；</p>
</li>
<li><p>持久性是通过 redo log （重做日志）来保证的；</p>
</li>
<li><p>隔离性是通过 MVCC（多版本并发控制） 和锁机制来保证的；</p>
</li>
<li><p>一致性则是通过持久性+原子性+隔离性来保证；</p>
</li>
</ul>
</blockquote>
<hr>
<h3 id="面试官：并发事务带来哪些问题？"><a href="#面试官：并发事务带来哪些问题？" class="headerlink" title="面试官：并发事务带来哪些问题？"></a><strong>面试官</strong>：并发事务带来哪些问题？</h3><p><strong>候选人</strong>：</p>
<p>我们在项目开发中，多个事务并发进行是经常发生的，并发也是必然的，有可能导致一些问题：</p>
<ol>
<li><p>第一是脏读：当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是“脏数据”，依据“脏数据”所做的操作可能是不正确的。<strong>（一个事务读到另一个事务还未提交的数据）</strong></p>
</li>
<li><p>第二是不可重复读：比如在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。<strong>（一个事务先后读取同一条记录，但两次读取的数据不同）</strong></p>
</li>
<li><p>第三是幻读（Phantom read）：幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了一些原本不存在的记录，就好像发生了幻觉一样，所以称为幻读。<strong>（一个事务按照条件查询时，没有对应的数据行，再次查询时发现多了一行数据）</strong></p>
</li>
</ol>
<blockquote>
<p>补充：<strong>不可重复读和幻读的区别</strong></p>
<p>不可重复读的重点是修改；幻读的重点是新增或者删除。</p>
</blockquote>
<hr>
<h3 id="面试官：怎么解决这些问题呢？MySQL的默认隔离级别是？（高频）"><a href="#面试官：怎么解决这些问题呢？MySQL的默认隔离级别是？（高频）" class="headerlink" title="面试官：怎么解决这些问题呢？MySQL的默认隔离级别是？（高频）"></a><strong>面试官</strong>：怎么解决这些问题呢？MySQL的默认隔离级别是？<code>（高频）</code></h3><p><strong>候选人</strong>：解决方案是<strong>对事务进行隔离</strong>。</p>
<p>MySQL支持四种隔离级别，分别有：</p>
<p>第一个是 <strong>未提交读（READ UNCOMMITTED）</strong> 它解决不了刚才提出的所有问题，一般项目中也不用这个。</p>
<p>第二个是 <strong>读已提交（READ COMMITTED）</strong> 它能解决脏读的问题的，但是解决不了不可重复读和幻读。</p>
<p>第三个是 <strong>可重复读（REPEATABLE READ）</strong> 在这个隔离级别下，事务在执行期间会锁定查询的数据行(临键锁)，确保该数据在事务完成前不会被其他事务修改。它能解决脏读和不可重复读，但是解决不了幻读，这个也是MySQL默认的隔离级别。</p>
<blockquote>
<p>除了“串行化”能解决幻读问题外，InnoDB 在<strong>可重复读 (Repeatable Read)</strong> 隔离级别下通过 <code>临键锁</code> 已经能够解决大部分幻读问题。可以用串行化来保证数据的强一致性来做兜底，而且还可以不用手动加锁。</p>
</blockquote>
<p>第四个是 <strong>串行化（SERIALIZABLE）</strong> 它可以解决刚才提出来的所有问题，但是由于让是事务串行执行的，性能比较低。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SET</span> SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;</span><br><span class="line"><span class="keyword">BEGIN</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> age <span class="operator">&gt;</span> <span class="number">20</span>; <span class="comment">-- 自动加共享锁</span></span><br><span class="line"><span class="comment">-- 其他事务无法插入或修改 age &gt; 20 的记录</span></span><br><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>所以，我们一般使用的都是MySQL默认的隔离级别为<strong>可重复读</strong>。</p>
<h3 id="面试官：MySQL-中单表最多不能超过2000w？为什么？"><a href="#面试官：MySQL-中单表最多不能超过2000w？为什么？" class="headerlink" title="面试官：MySQL 中单表最多不能超过2000w？为什么？"></a><strong>面试官</strong>：MySQL 中单表最多不能超过2000w？为什么？</h3><p><strong>候选人</strong>：</p>
<ul>
<li><p>MySQL 的表数据是以页的形式存放的，页在磁盘中不一定是连续的。</p>
</li>
<li><p>页的空间是 16K, 并不是所有的空间都是用来存放数据的,会有一些固定的信息,如,页头,页尾,页码,校验码等等。</p>
</li>
<li><p>在 B+ 树中，叶子节点和非叶子节点的数据结构是一样的，区别在于：叶子节点存放的是实际的行数据,而非叶子节点存放的是主键和页号。</p>
</li>
<li><p>索引结构不会影响单表最大行数，2000W 也只是推荐值，超过了这个值可能会导致B+ 树层级更高，影响查询性能。</p>
</li>
</ul>
<hr>
<h3 id="面试官：事务中的隔离性是如何保证的呢？-你解释一下MVCC"><a href="#面试官：事务中的隔离性是如何保证的呢？-你解释一下MVCC" class="headerlink" title="面试官：事务中的隔离性是如何保证的呢？(你解释一下MVCC)"></a><strong>面试官</strong>：事务中的隔离性是如何保证的呢？(你解释一下MVCC)</h3><p><strong>候选人</strong>：事务的隔离性是由<strong>锁和MVCC</strong>实现的。</p>
<p>其中MVCC的意思是多版本并发控制。指维护一个数据的多个版本，使得读写操作没有冲突，它的底层实现主要是分为了三个部分，第一个是隐藏字段，第二个是undo log日志，第三个是readView读视图。</p>
<p>隐藏字段是指：在mysql中给每个表都设置了隐藏字段，有一个是trx_id(事务id)，记录每一次操作的事务id，是自增的；另一个字段是roll_pointer(回滚指针)，指向上一个版本的事务版本记录地址。</p>
<p>undo log主要的作用是<strong>记录回滚日志，存储老版本数据</strong>，在内部会形成一个版本链，在多个事务并行操作某一行记录，<strong>记录不同事务修改数据的版本</strong>，通过roll_pointer指针形成一个链表。</p>
<p>readView解决的是一个事务查询选择版本的问题，在内部定义了一些匹配规则和当前的一些事务id判断该访问那个版本的数据，不同的隔离级别快照读是不一样的，最终的访问的结果不一样。<strong>如果是rc隔离级别，每一次执行快照读时生成readView，如果是rr隔离级别仅在事务中第一次执行快照读时生成ReadView，后续复用</strong>。</p>
<h3 id="面试官：MySQL主从同步原理"><a href="#面试官：MySQL主从同步原理" class="headerlink" title="面试官：MySQL主从同步原理"></a><strong>面试官</strong>：MySQL主从同步原理</h3><p><strong>候选人</strong>：MySQL主从复制的核心就是二进制日志(DDL（数据定义语言）语句和 DML（数据操纵语言）语句)，它的步骤是这样的：</p>
<p>第一：主库在事务提交时，会把数据变更记录在二进制日志文件 Binlog 中。</p>
<p>第二：从库读取主库的二进制日志文件 Binlog ，写入到从库的<strong>中继日志 Relay Log</strong> 。</p>
<p>第三：从库重做中继日志中的事件，将改变反映它自己的数据。</p>
<blockquote>
<p>思考：<strong>为什么不让从库直接读取主库的binlog文件呢？中继日志的作用是什么？</strong></p>
<p>如果多个从库直接连接到主库并读取其binlog，这会增加主库的网络负载和磁盘IO压力。</p>
<p>如果从库失败，可通过中继日志快速恢复到失败前的状态，有助于加速从库的恢复过程。</p>
<p>由于中继日志是本地存储的，因此读取速度通常更快。</p>
</blockquote>
<h3 id="面试官：-谈谈你对读写分离和分库分表的理解（高频）"><a href="#面试官：-谈谈你对读写分离和分库分表的理解（高频）" class="headerlink" title="面试官： 谈谈你对读写分离和分库分表的理解（高频）"></a><strong>面试官：</strong> 谈谈你对读写分离和分库分表的理解<code>（高频）</code></h3><p><strong>候选人:</strong></p>
<h3 id="读写分离"><a href="#读写分离" class="headerlink" title="读写分离"></a>读写分离</h3><h4 id="何为读写分离？"><a href="#何为读写分离？" class="headerlink" title="何为读写分离？"></a>何为读写分离？</h4><p>见名思意，根据读写分离的名字，我们就可以知道：<strong>读写分离主要是为了将对数据库的读写操作分散到不同的数据库节点上。</strong> 这样的话，就能够小幅提升写性能，大幅提升读性能。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://pic1.imgdb.cn/item/67e15e040ba3d5a1d7e2a2c1.png" alt="image-20250219223812794"></p>
<p>一般情况下，我们都会选择一主多从，也就是<strong>一台主数据库负责写，其他的从数据库负责读</strong>。主库和从库之间会进行数据同步，以保证从库中数据的准确性。</p>
<h4 id="读写分离会带来什么问题？如何解决？"><a href="#读写分离会带来什么问题？如何解决？" class="headerlink" title="读写分离会带来什么问题？如何解决？"></a>读写分离会带来什么问题？如何解决？</h4><p>读写分离对于提升数据库的并发非常有效，但是，同时也会引来一个问题：主库和从库的数据存在延迟，比如你写完主库之后，主库的数据同步到从库是需要时间的，这个时间差就导致了主库和从库的数据不一致性问题。这也就是我们经常说的 <strong>主从同步延迟</strong> 。</p>
<p>解决方案：</p>
<p><strong>1.强制将读请求路由到主库处理。</strong></p>
<p>既然你从库的数据过期了，那我就直接从主库读取嘛！这种方案虽然会增加主库的压力，但是，实现起来比较简单，也是我了解到的使用最多的一种方式。</p>
<p><strong>2.延迟读取。</strong></p>
<p>还有一些朋友肯定会想既然主从同步存在延迟，那我就在延迟之后读取啊，比如主从同步延迟 0.5s,那我就 1s 之后再读取数据。这样多方便啊！方便是方便，但是也很扯淡。</p>
<p>不过，如果你是这样设计业务流程就会好很多：对于一些对数据比较敏感的场景，你可以在完成写请求之后，避免立即进行请求操作。比如你支付成功之后，跳转到一个支付成功的页面，当你点击返回之后才返回自己的账户。</p>
<h4 id="如何实现读写分离？"><a href="#如何实现读写分离？" class="headerlink" title="如何实现读写分离？"></a>如何实现读写分离？</h4><p>不论是使用哪一种读写分离具体的实现方案，想要实现读写分离一般包含如下几步：</p>
<ol>
<li>部署多台数据库，选择一种的一台作为主数据库，其他的一台或者多台作为从数据库。</li>
<li>保证主数据库和从数据库之间的数据是实时同步的。</li>
<li>系统将写请求交给主数据库处理，读请求交给从数据库处理。</li>
</ol>
<h3 id="分库分表"><a href="#分库分表" class="headerlink" title="分库分表"></a>分库分表</h3><p>读写分离主要应对的是数据库读并发，没有解决数据库存储问题。试想一下：<strong>如果 MySQL 一张表的数据量过大怎么办?</strong></p>
<p>换言之，<strong>我们该如何解决 MySQL 的存储压力呢？</strong></p>
<p>答案之一就是 <strong>分库分表</strong>。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://pic1.imgdb.cn/item/67e15e300ba3d5a1d7e2a2cc.png" alt="image-20250219223901151"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://pic1.imgdb.cn/item/67e15e380ba3d5a1d7e2a2cd.png" alt="image-20250219223910561"></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://pic1.imgdb.cn/item/67e15e400ba3d5a1d7e2a2ce.png" alt="image-20250219223920177"></p>
<h4 id="什么情况下需要分库分表？"><a href="#什么情况下需要分库分表？" class="headerlink" title="什么情况下需要分库分表？"></a>什么情况下需要分库分表？</h4><p>遇到下面几种场景可以考虑分库分表：</p>
<ul>
<li><strong>单表的数据达到千万级别以上</strong>，数据库读写速度比较缓慢（分表）。</li>
<li>数据库中的数据<strong>占用的空间越来越大</strong>，备份时间越来越长（分库）。</li>
<li>应用的<strong>并发量太大</strong>（分库）。</li>
</ul>
<h4 id="分库分表会带来什么问题呢？"><a href="#分库分表会带来什么问题呢？" class="headerlink" title="分库分表会带来什么问题呢？"></a>分库分表会带来什么问题呢？</h4><p>引入分库分表之后，会给系统带来什么挑战呢？</p>
<ul>
<li><strong>join 操作</strong> ：同一个数据库中的表分布在了不同的数据库中，导致无法使用 join 操作。这样就导致我们需要手动进行数据的<code>封装</code>，比如你在一个数据库中查询到一个数据之后，再根据这个数据去另外一个数据库中找对应的数据。</li>
<li><strong>事务问题</strong> ：同一个数据库中的表分布在不同的数据库中，如果单个操作涉及到多个数据库，那么数据库自带的事务就无法满足我们的要求了。</li>
<li><strong>分布式 id</strong> ：分库之后， 数据遍布在不同服务器上的数据库，数据库的自增主键已经没办法满足生成的主键唯一了。我们如何为不同的数据节点生成全局唯一主键呢？这个时候，我们就需要为我们的系统引入<code>分布式id</code>了。</li>
</ul>
<h3 id="相关阅读：揭秘！MySQL索引背后的秘密武器：B-树为何力压跳表，独领风骚？"><a href="#相关阅读：揭秘！MySQL索引背后的秘密武器：B-树为何力压跳表，独领风骚？" class="headerlink" title="相关阅读：揭秘！MySQL索引背后的秘密武器：B+树为何力压跳表，独领风骚？"></a>相关阅读：<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_74199893/article/details/140401043">揭秘！MySQL索引背后的秘密武器：B+树为何力压跳表，独领风骚？</a></h3></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://pic1.imgdb.cn/item/67e6c7490ba3d5a1d7e5c8f7.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://pic1.imgdb.cn/item/67e6c7490ba3d5a1d7e5c8f7.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">玦尘</div><div class="post-copyright__author_desc">Aslamu alaykum🥥</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://miahemu.github.io/2025/03/24/MySQL%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://miahemu.github.io/2025/03/24/MySQL相关面试题/')">MySQL相关面试题</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://i.miji.bid/2025/03/23/eeafc8609ad2edbb8e7112ced837d7f4.jpeg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://i.miji.bid/2025/03/23/eeafc8609ad2edbb8e7112ced837d7f4.jpeg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://i.miji.bid/2025/03/29/81b165cb796725599ea7e82472ce9896.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://i.miji.bid/2025/03/29/81b165cb796725599ea7e82472ce9896.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://miahemu.github.io/2025/03/24/MySQL%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://miahemu.github.io" target="_blank">和睦的拾光物语</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/JAVA%E9%9D%A2%E7%BB%8F/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>JAVA面经<span class="tagsPageCount">12</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://w.wallhaven.cc/full/yx/wallhaven-yxlwq7.jpg" data-sites="facebook,twitter,wechat,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/03/24/%E5%90%8E%E7%AB%AF%E9%AB%98%E9%A2%91%E7%AC%94%E8%AF%95%E9%A2%98/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/e7/wallhaven-e72xkw.jpg" onerror="onerror=null;src='https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">后端高频笔试题（非常规LC题）</div></div></a></div><div class="next-post pull-right"><a href="/2025/03/25/TCP%E9%87%8D%E4%BC%A0%E7%AD%89/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/57/wallhaven-575do8.png" onerror="onerror=null;src='https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">破解网络奥秘：一图胜千言，TCP重传、滑动窗口、流量与拥塞控制全解析</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/03/30/JUC%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/" title="JUC相关面试题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/j3/wallhaven-j3rgqw.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-30</div><div class="title">JUC相关面试题</div></div></a></div><div><a href="/2025/03/30/JVM%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/" title="JVM相关面试题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/d6/wallhaven-d6225m.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-30</div><div class="title">JVM相关面试题</div></div></a></div><div><a href="/2025/03/22/JavaSE%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/" title="JavaSE相关面试题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/l8/wallhaven-l8ejkp.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-22</div><div class="title">JavaSE相关面试题</div></div></a></div><div><a href="/2025/03/23/Java%E9%9B%86%E5%90%88%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/" title="Java集合相关面试题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/qz/wallhaven-qzwme5.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-23</div><div class="title">Java集合相关面试题</div></div></a></div><div><a href="/2025/03/25/Redis%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/" title="Redis相关面试题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/xl/wallhaven-xl8p9d.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-25</div><div class="title">Redis相关面试题</div></div></a></div><div><a href="/2025/03/23/SSM%E6%A1%86%E6%9E%B6%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/" title="SSM框架相关面试题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/zy/wallhaven-zywwky.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-23</div><div class="title">SSM框架相关面试题</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://pic1.imgdb.cn/item/67e6c7490ba3d5a1d7e5c8f7.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"><div style="line-height:1.38;margin:0.6rem 0;text-align:justify;color:rgba(255, 255, 255, 0.8);">🌙惟信道而且行善，并以真理相劝，以坚忍相勉的人则不然。<br>----时光章[103:3]</div></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">玦尘</h1><div class="author-info__desc">Aslamu alaykum🥥</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/miahemu" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/1046498117" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">1.屏幕太大功能显示不全的话，可以手动"ctrl + -"来缩放页面。  2.网页右上角换至深色主题效果更佳✨   3.网页左下角可以播放音乐哦☀️</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E4%B8%89%E5%A4%A7%E8%8C%83%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">面试官： 数据库的三大范式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E8%AF%B4%E4%B8%80%E4%B8%8B%E5%A4%96%E9%94%AE%E7%BA%A6%E6%9D%9F"><span class="toc-number">2.</span> <span class="toc-text">面试官： 说一下外键约束</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E8%AF%B4%E4%B8%80%E4%B8%8Bbinlog"><span class="toc-number">3.</span> <span class="toc-text">面试官： 说一下binlog</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9AMySQL-binlog%EF%BC%8Credolog%E5%92%8Cundolog%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">4.</span> <span class="toc-text">面试官：MySQL binlog，redolog和undolog的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-MyISAM%E5%92%8CInnoDB%E5%8C%BA%E5%88%AB"><span class="toc-number">5.</span> <span class="toc-text">面试官： MyISAM和InnoDB区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-MySQL%EF%BC%88%E4%BB%A5-InnoDB-%E4%B8%BA%E4%BE%8B%EF%BC%89%E5%AE%9E%E7%8E%B0%E7%9A%84%E9%94%81%E7%B1%BB%E5%9E%8B%EF%BC%9F"><span class="toc-number">6.</span> <span class="toc-text">面试官： MySQL（以 InnoDB 为例）实现的锁类型？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-MySQL%E4%B8%AD%EF%BC%8C%E5%A6%82%E4%BD%95%E5%AE%9A%E4%BD%8D%E6%85%A2%E6%9F%A5%E8%AF%A2-%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-number">7.</span> <span class="toc-text">面试官： MySQL中，如何定位慢查询?（高频）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E9%82%A3%E8%BF%99%E4%B8%AASQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E5%BE%88%E6%85%A2-%E5%A6%82%E4%BD%95%E5%88%86%E6%9E%90%E5%91%A2%EF%BC%9F%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-number">8.</span> <span class="toc-text">面试官： 那这个SQL语句执行很慢, 如何分析呢？（高频）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E4%B8%80%E6%9D%A1SQL%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E5%BE%97%E5%BE%88%E6%85%A2%E7%9A%84%E5%8E%9F%E5%9B%A0%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-number">9.</span> <span class="toc-text">面试官： 一条SQL语句执行得很慢的原因有哪些？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E9%92%88%E5%AF%B9%E5%81%B6%E5%B0%94%E5%BE%88%E6%85%A2%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">9.1.</span> <span class="toc-text">一、针对偶尔很慢的情况</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E9%92%88%E5%AF%B9%E4%B8%80%E7%9B%B4%E9%83%BD%E8%BF%99%E4%B9%88%E6%85%A2%E7%9A%84%E6%83%85%E5%86%B5"><span class="toc-number">9.2.</span> <span class="toc-text">二、针对一直都这么慢的情况</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-MySQL%E4%B8%AD-SQL-%E6%9F%A5%E8%AF%A2%E5%92%8C%E6%9B%B4%E6%96%B0%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B%EF%BC%9F"><span class="toc-number">10.</span> <span class="toc-text">面试官： MySQL中 SQL 查询和更新语句的执行流程？</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80%E3%80%81-MySQL-%E5%9F%BA%E7%A1%80%E6%9E%B6%E6%9E%84%E5%88%86%E6%9E%90"><span class="toc-number">10.1.</span> <span class="toc-text">一、 MySQL 基础架构分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E8%AF%AD%E5%8F%A5%E5%88%86%E6%9E%90"><span class="toc-number">10.2.</span> <span class="toc-text">二、语句分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-IP%E5%9C%B0%E5%9D%80%E5%A6%82%E4%BD%95%E5%9C%A8%E6%95%B0%E6%8D%AE%E5%BA%93%E9%87%8C%E5%AD%98%E5%82%A8%EF%BC%9F"><span class="toc-number">11.</span> <span class="toc-text">面试官： IP地址如何在数据库里存储？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E4%BB%80%E4%B9%88%E6%98%AF%E7%B4%A2%E5%BC%95-%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-number">12.</span> <span class="toc-text">面试官： 什么是索引 （高频）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E7%B4%A2%E5%BC%95%E7%9A%84%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%BA%86%E8%A7%A3%E8%BF%87%E5%98%9B-%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-number">13.</span> <span class="toc-text">面试官： 索引的底层数据结构了解过嘛 ? （高频）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-B%E6%A0%91%E5%92%8CB-%E6%A0%91%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%E5%91%A2%EF%BC%9F%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-number">14.</span> <span class="toc-text">面试官： B树和B+树的区别是什么呢？（高频）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E4%BB%80%E4%B9%88%E6%98%AF%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95%EF%BC%9F%E4%BB%80%E4%B9%88%E6%98%AF%E9%9D%9E%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95%EF%BC%88%E8%BE%85%E5%8A%A9%E7%B4%A2%E5%BC%95%EF%BC%89"><span class="toc-number">15.</span> <span class="toc-text">面试官： 什么是聚簇索引？什么是非聚簇索引（辅助索引） ?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E7%9F%A5%E9%81%93%E4%BB%80%E4%B9%88%E6%98%AF%E5%9B%9E%E8%A1%A8%E6%9F%A5%E8%AF%A2%E5%98%9B"><span class="toc-number">16.</span> <span class="toc-text">面试官： 知道什么是回表查询嘛 ?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-MySQL%E7%9A%84%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95%E4%B8%BA%E4%BB%80%E4%B9%88%E7%94%A8%E8%87%AA%E5%A2%9EID%EF%BC%8C%E4%B8%8D%E4%BD%BF%E7%94%A8UUID%EF%BC%9F"><span class="toc-number">17.</span> <span class="toc-text">面试官： MySQL的主键索引为什么用自增ID，不使用UUID？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E7%9F%A5%E9%81%93%E4%BB%80%E4%B9%88%E5%8F%AB%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%95%E5%98%9B"><span class="toc-number">18.</span> <span class="toc-text">面试官： 知道什么叫覆盖索引嘛 ?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-MySQL%E8%B6%85%E5%A4%A7%E5%88%86%E9%A1%B5%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86"><span class="toc-number">19.</span> <span class="toc-text">面试官： MySQL超大分页怎么处理 ?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E7%B4%A2%E5%BC%95%E4%BC%9A%E5%A4%B1%E6%95%88-%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-number">20.</span> <span class="toc-text">面试官： 什么情况下索引会失效 ?（高频）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-sql%E7%9A%84%E4%BC%98%E5%8C%96%E7%9A%84%E7%BB%8F%E9%AA%8C%EF%BC%88%E6%85%A2%E6%9F%A5%E8%AF%A2%E4%BC%98%E5%8C%96%EF%BC%89%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-number">21.</span> <span class="toc-text">面试官： sql的优化的经验（慢查询优化）（高频）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E4%BD%A0%E4%BB%AC%E6%98%AF%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96%E7%9A%84%E5%91%A2%EF%BC%9F"><span class="toc-number">22.</span> <span class="toc-text">面试官： 创建表的时候，你们是如何优化的呢？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E9%82%A3%E5%9C%A8%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95%E7%9A%84%E6%97%B6%E5%80%99%EF%BC%8C%E6%98%AF%E5%A6%82%E4%BD%95%E4%BC%98%E5%8C%96%E5%91%A2%EF%BC%9F%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-number">23.</span> <span class="toc-text">面试官： 那在使用索引的时候，是如何优化呢？（高频）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E4%BD%A0%E5%B9%B3%E6%97%B6%E5%AF%B9sql%E8%AF%AD%E5%8F%A5%E5%81%9A%E4%BA%86%E5%93%AA%E4%BA%9B%E4%BC%98%E5%8C%96%E5%91%A2%EF%BC%9F%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-number">24.</span> <span class="toc-text">面试官： 你平时对sql语句做了哪些优化呢？（高频）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%89%B9%E6%80%A7%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E5%8F%AF%E4%BB%A5%E8%AF%A6%E7%BB%86%E8%AF%B4%E4%B8%80%E4%B8%8B%E5%90%97%EF%BC%9F"><span class="toc-number">25.</span> <span class="toc-text">面试官： 事务的特性是什么？可以详细说一下吗？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E5%B8%A6%E6%9D%A5%E5%93%AA%E4%BA%9B%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">26.</span> <span class="toc-text">面试官：并发事务带来哪些问题？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A%E6%80%8E%E4%B9%88%E8%A7%A3%E5%86%B3%E8%BF%99%E4%BA%9B%E9%97%AE%E9%A2%98%E5%91%A2%EF%BC%9FMySQL%E7%9A%84%E9%BB%98%E8%AE%A4%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB%E6%98%AF%EF%BC%9F%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-number">27.</span> <span class="toc-text">面试官：怎么解决这些问题呢？MySQL的默认隔离级别是？（高频）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9AMySQL-%E4%B8%AD%E5%8D%95%E8%A1%A8%E6%9C%80%E5%A4%9A%E4%B8%8D%E8%83%BD%E8%B6%85%E8%BF%872000w%EF%BC%9F%E4%B8%BA%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">28.</span> <span class="toc-text">面试官：MySQL 中单表最多不能超过2000w？为什么？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A%E4%BA%8B%E5%8A%A1%E4%B8%AD%E7%9A%84%E9%9A%94%E7%A6%BB%E6%80%A7%E6%98%AF%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E7%9A%84%E5%91%A2%EF%BC%9F-%E4%BD%A0%E8%A7%A3%E9%87%8A%E4%B8%80%E4%B8%8BMVCC"><span class="toc-number">29.</span> <span class="toc-text">面试官：事务中的隔离性是如何保证的呢？(你解释一下MVCC)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9AMySQL%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%8E%9F%E7%90%86"><span class="toc-number">30.</span> <span class="toc-text">面试官：MySQL主从同步原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%A2%E8%AF%95%E5%AE%98%EF%BC%9A-%E8%B0%88%E8%B0%88%E4%BD%A0%E5%AF%B9%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E5%92%8C%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E7%9A%84%E7%90%86%E8%A7%A3%EF%BC%88%E9%AB%98%E9%A2%91%EF%BC%89"><span class="toc-number">31.</span> <span class="toc-text">面试官： 谈谈你对读写分离和分库分表的理解（高频）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB"><span class="toc-number">32.</span> <span class="toc-text">读写分离</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%95%E4%B8%BA%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F"><span class="toc-number">32.1.</span> <span class="toc-text">何为读写分离？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E4%BC%9A%E5%B8%A6%E6%9D%A5%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%EF%BC%9F%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%EF%BC%9F"><span class="toc-number">32.2.</span> <span class="toc-text">读写分离会带来什么问题？如何解决？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F"><span class="toc-number">32.3.</span> <span class="toc-text">如何实现读写分离？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8"><span class="toc-number">33.</span> <span class="toc-text">分库分表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E9%9C%80%E8%A6%81%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%EF%BC%9F"><span class="toc-number">33.1.</span> <span class="toc-text">什么情况下需要分库分表？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E5%BA%93%E5%88%86%E8%A1%A8%E4%BC%9A%E5%B8%A6%E6%9D%A5%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%E5%91%A2%EF%BC%9F"><span class="toc-number">33.2.</span> <span class="toc-text">分库分表会带来什么问题呢？</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E9%98%85%E8%AF%BB%EF%BC%9A%E6%8F%AD%E7%A7%98%EF%BC%81MySQL%E7%B4%A2%E5%BC%95%E8%83%8C%E5%90%8E%E7%9A%84%E7%A7%98%E5%AF%86%E6%AD%A6%E5%99%A8%EF%BC%9AB-%E6%A0%91%E4%B8%BA%E4%BD%95%E5%8A%9B%E5%8E%8B%E8%B7%B3%E8%A1%A8%EF%BC%8C%E7%8B%AC%E9%A2%86%E9%A3%8E%E9%AA%9A%EF%BC%9F"><span class="toc-number">34.</span> <span class="toc-text">相关阅读：揭秘！MySQL索引背后的秘密武器：B+树为何力压跳表，独领风骚？</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/05/2024%E6%90%BA%E7%A8%8B%E6%98%A5%E5%AD%A3%E7%AC%94%E8%AF%95/" title="2024携程春季笔试真题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/yx/wallhaven-yxlwq7.jpg" onerror="this.onerror=null;this.src='https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg'" alt="2024携程春季笔试真题"/></a><div class="content"><a class="title" href="/2025/04/05/2024%E6%90%BA%E7%A8%8B%E6%98%A5%E5%AD%A3%E7%AC%94%E8%AF%95/" title="2024携程春季笔试真题">2024携程春季笔试真题</a><time datetime="2025-04-04T16:00:00.000Z" title="发表于 2025-04-05 00:00:00">2025-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/05/2025%E8%85%BE%E8%AE%AF%E4%BA%91%E6%99%BA%E6%98%A5%E5%AD%A3%E7%AC%94%E8%AF%95/" title="2025腾讯云智春季笔试真题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/57/wallhaven-577kk1.jpg" onerror="this.onerror=null;this.src='https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg'" alt="2025腾讯云智春季笔试真题"/></a><div class="content"><a class="title" href="/2025/04/05/2025%E8%85%BE%E8%AE%AF%E4%BA%91%E6%99%BA%E6%98%A5%E5%AD%A3%E7%AC%94%E8%AF%95/" title="2025腾讯云智春季笔试真题">2025腾讯云智春季笔试真题</a><time datetime="2025-04-04T16:00:00.000Z" title="发表于 2025-04-05 00:00:00">2025-04-05</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/04/2024oppo%E6%98%A5%E5%AD%A3%E7%AC%94%E8%AF%95/" title="2024oppo春季笔试真题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/pk/wallhaven-pk7q3p.jpg" onerror="this.onerror=null;this.src='https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg'" alt="2024oppo春季笔试真题"/></a><div class="content"><a class="title" href="/2025/04/04/2024oppo%E6%98%A5%E5%AD%A3%E7%AC%94%E8%AF%95/" title="2024oppo春季笔试真题">2024oppo春季笔试真题</a><time datetime="2025-04-03T16:00:00.000Z" title="发表于 2025-04-04 00:00:00">2025-04-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/04/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/" title="消息中间件相关面试题（MQ、Kafka）"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/6o/wallhaven-6o7qpx.jpg" onerror="this.onerror=null;this.src='https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg'" alt="消息中间件相关面试题（MQ、Kafka）"/></a><div class="content"><a class="title" href="/2025/04/04/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6%E7%9B%B8%E5%85%B3%E9%9D%A2%E8%AF%95%E9%A2%98/" title="消息中间件相关面试题（MQ、Kafka）">消息中间件相关面试题（MQ、Kafka）</a><time datetime="2025-04-03T16:00:00.000Z" title="发表于 2025-04-04 00:00:00">2025-04-04</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/03/2024vivo%E6%98%A5%E5%AD%A3%E7%AC%94%E8%AF%95/" title="2024vivo春季笔试真题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://w.wallhaven.cc/full/p9/wallhaven-p9r8qe.jpg" onerror="this.onerror=null;this.src='https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg'" alt="2024vivo春季笔试真题"/></a><div class="content"><a class="title" href="/2025/04/03/2024vivo%E6%98%A5%E5%AD%A3%E7%AC%94%E8%AF%95/" title="2024vivo春季笔试真题">2024vivo春季笔试真题</a><time datetime="2025-04-02T16:00:00.000Z" title="发表于 2025-04-03 00:00:00">2025-04-03</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer_deal"><a class="deal_link" target="_blank" rel="noopener" href="https://mail.qq.com" title="email"><i class="anzhiyufont anzhiyu-icon-envelope"></i></a><img class="footer_mini_logo" title="返回顶部" alt="返回顶部" onclick="anzhiyu.scrollToDest(0, 500)" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://pic1.imgdb.cn/item/67e6c7490ba3d5a1d7e5c8f7.png" size="50px"/><a class="deal_link" href="https://miahemu.github.io" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a></div><div id="workboard"><div id="runtimeTextTip"></div></div><div id="anzhiyu-footer"><div class="footer-group"><div class="footer-title">服务</div><div class="footer-links"><a class="footer-item" title="51la统计" target="_blank" rel="noopener" href="https://v6.51.la/">51la统计</a><a class="footer-item" title="十年之约" target="_blank" rel="noopener" href="https://www.foreverblog.cn/">十年之约</a><a class="footer-item" title="开往" target="_blank" rel="noopener" href="https://github.com/travellings-link/travellings">开往</a></div></div><div class="footer-group"><div class="footer-title">导航</div><div class="footer-links"><a class="footer-item" title="即刻短文" href="/essay/">即刻短文</a><a class="footer-item" title="友链文章" href="/fcircle/">友链文章</a><a class="footer-item" title="留言板" href="/comments/">留言板</a></div></div><div class="footer-group"><div class="footer-title-group"><div class="footer-title">友链</div><a class="random-friends-btn" id="footer-random-friends-btn" href="javascript:addFriendLinksInFooter();" title="换一批友情链接"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right"></i></a></div><div class="footer-links" id="friend-links-in-footer"></div></div></div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="玦尘" target="_blank">玦尘</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  fetch('https://v1.hitokoto.cn')
    .then(response => response.json())
    .then(data => {
      if (true) {
        const from = '出自 ' + data.from
        const sub = ["心怀信仰&#44; 步步生光&#44; 主恩常在&#44; 万物蒙福."]
        sub.unshift(data.hitokoto, from)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = data.hitokoto
      }
    })
}

if (true) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.cbd.int/typed.js@2.1.0/dist/typed.umd.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" href="https://miahemu.github.io" title="Allah will bless you☘️">Allah will bless you☘️</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">26</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">5</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://github.com/miahemu" title="GitHub"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="GitHub"/><span class="back-menu-item-text">GitHub</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://leetcode.cn/u/lu-ren-r41/" title="力扣"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="力扣"/><span class="back-menu-item-text">力扣</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://leetcode.cn/u/lu-ren-r41/" title="CSDN"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="CSDN"/><span class="back-menu-item-text">CSDN</span></a><a class="back-menu-item" href="https://miahemu.github.io/about/" title="个人简介"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;https://w.wallhaven.cc/full/jx/wallhaven-jx6yj5.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="个人简介"/><span class="back-menu-item-text">个人简介</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 总览</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=9460279562&amp;server=tencent"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 小挂件</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/weather/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 天气</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/JAVA%E9%9D%A2%E7%BB%8F/" style="font-size: 0.88rem;">JAVA面经<sup>12</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">数据结构与算法<sup>1</sup></a><a href="/tags/%E7%AC%94%E8%AF%95/" style="font-size: 0.88rem;">笔试<sup>9</sup></a><a href="/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">计算机网络<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="9461259355" server="tencent" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("2025/3/22 07:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 玦尘 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("2025/3/22 07:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "";
        img.title = "";
        img.alt = "";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><script src="/js/search/local-search.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><div class="aplayer no-destroy" data-id="565851830" data-server="netease" data-type="song" data-mini="true" data-autoplay="true" data-lrcType="-1"> </div><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>